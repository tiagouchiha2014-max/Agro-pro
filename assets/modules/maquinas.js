function pageMaquinas(){const a=getDB(),e=onlySafra(a.maquinas||[]);setTopActions('<button class="btn" id="btnExportMaq">Exportar CSV</button>');const o=[{grupo:"üöú Tratores",itens:[{nome:"Trator de Pneu 4x2",marca:"John Deere",modelo:"5075E",cap:0,obs:"75 cv, tra√ß√£o simples"},{nome:"Trator de Pneu 4x4",marca:"New Holland",modelo:"TL5.90",cap:0,obs:"90 cv, tra√ß√£o dupla"},{nome:"Trator de Esteira",marca:"Case IH",modelo:"Quadtrac 500",cap:0,obs:"500 cv, alta tra√ß√£o"},{nome:"Trator Compacto / Fruticultura",marca:"Massey Ferguson",modelo:"MF 4275",cap:0,obs:"75 cv, baixo perfil"}]},{grupo:"üåæ Colheitadeiras",itens:[{nome:"Colheitadeira de Soja",marca:"John Deere",modelo:"S780",cap:0,obs:"Plataforma flex√≠vel 35 p√©s"},{nome:"Colheitadeira de Milho",marca:"New Holland",modelo:"CR10.90",cap:0,obs:"Plataforma milho 8 linhas"},{nome:"Colheitadeira de Trigo/Arroz",marca:"AGCO",modelo:"Ideal 9T",cap:0,obs:"Plataforma 30 p√©s"},{nome:"Colheitadeira de Algod√£o",marca:"Case IH",modelo:"Module Express 635",cap:0,obs:"Stripper / picker"},{nome:"Colheitadeira de Cana",marca:"John Deere",modelo:"CH570",cap:0,obs:"Colheita inteira/picada"},{nome:"Colheitadeira de Caf√©",marca:"JACTO",modelo:"K3 Plus",cap:0,obs:"Derri√ßadeira autopropelida"}]},{grupo:"üíß Pulverizadores",itens:[{nome:"Pulverizador Autopropelido",marca:"JACTO",modelo:"Uniport 4530",cap:4530,obs:"4530L, barra 30m"},{nome:"Pulverizador Autopropelido",marca:"Stara",modelo:"Imperador 3.0",cap:3e3,obs:"3000L, barra 36m"},{nome:"Pulverizador de Arrasto",marca:"Vicon",modelo:"VX1000",cap:1e3,obs:"1000L, barra 18m"},{nome:"Pulverizador de 3 Pontos",marca:"Jacto",modelo:"AD-13",cap:400,obs:"400L, barra 13m"},{nome:"Drone Pulverizador",marca:"DJI",modelo:"Agras T40",cap:40,obs:"40L, √°rea 8ha/h"}]},{grupo:"üå± Plantio & Preparo",itens:[{nome:"Plantadeira de Soja",marca:"Stara",modelo:"Absoluta 48",cap:0,obs:"48 linhas, disco duplo"},{nome:"Plantadeira de Milho",marca:"Precision Planting",modelo:"vSet2 20 linhas",cap:0,obs:"20 linhas, dose vari√°vel"},{nome:"Grade Aradora",marca:"Baldan",modelo:"GAR 28x26",cap:0,obs:'28 discos 26"'},{nome:"Grade Niveladora",marca:"Baldan",modelo:"GNV 48x22",cap:0,obs:'48 discos 22"'},{nome:"Subsolador",marca:"Tatu",modelo:"Titan 7 hastes",cap:0,obs:"7 hastes, prof. 50cm"},{nome:"Semeadeira Direta",marca:"Marchesan",modelo:"Presert III 15 linhas",cap:0,obs:"15 linhas, sulcador haste"}]},{grupo:"üöö Transporte & Log√≠stica",itens:[{nome:"Caminh√£o Graneleiro",marca:"Mercedes-Benz",modelo:"Atron 2729",cap:0,obs:"Carga 15t, graneleiro"},{nome:"Tra√ßado / Truck Graneleiro",marca:"Scania",modelo:"R450",cap:0,obs:"Carga 25t, rodotrem"},{nome:"Carreta Graneleira",marca:"Randon",modelo:"SR BA",cap:0,obs:"34.000L, eixo duplo"},{nome:"Vag√£o Graneleiro (Tracionado)",marca:"Incomagri",modelo:"VG 8000",cap:8e3,obs:"8t, tra√ß√£o p/ trator"},{nome:"Toco Boiadeiro",marca:"Volkswagen",modelo:"Constellation 24.280",cap:0,obs:"Transporte animais"}]},{grupo:"‚õΩ Abastecimento & Infra",itens:[{nome:"Tanque Reboque Diesel",marca:"Usina",modelo:"TR 3000L",cap:3e3,obs:"3000L, bomba 50L/min"},{nome:"Gerador a Diesel",marca:"Stemac",modelo:"GE50000",cap:0,obs:"50kVA, trif√°sico"},{nome:"Bomba Hidr√°ulica",marca:"Dancor",modelo:"CVR-7",cap:0,obs:"7cv, irriga√ß√£o"},{nome:"Piv√¥ Central de Irriga√ß√£o",marca:"Reinke",modelo:"E2065",cap:0,obs:"√Årea 65ha, el√©trico"}]},{grupo:"üîß Outros Equipamentos",itens:[{nome:"Ro√ßadeira Hidr√°ulica",marca:"Triton",modelo:"TH-2000",cap:0,obs:"Bra√ßo articulado 2m"},{nome:"Empilhadeira / Telehandler",marca:"JLG",modelo:"TH644C",cap:0,obs:"4t, alcance 6m"},{nome:"Carregadeira Frontal",marca:"Caterpillar",modelo:"906M",cap:0,obs:"Bucket 1m¬≥"},{nome:"ATV / Quadriciclo",marca:"Yamaha",modelo:"Grizzly 700",cap:0,obs:"700cc, monitoramento"}]}];document.getElementById("content").innerHTML=`\n    <style>\n      .maq-kpi { display:grid; grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:12px; margin-bottom:20px; }\n      .maq-kpi .card { text-align:center; padding:14px; }\n      .maq-kpi .big { font-size:28px; font-weight:800; color:#3b82f6; }\n      .maq-tabs { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:18px; }\n      .maq-tab { padding:7px 16px; border-radius:20px; border:1px solid #cbd5e1; background:#f8fafc; cursor:pointer; font-size:13px; font-weight:500; transition:all .2s; }\n      .maq-tab.active { background:#3b82f6; color:white; border-color:#3b82f6; }\n      .maq-presets { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:12px; margin-bottom:24px; }\n      .maq-preset-card { background:white; border:1px solid #e2e8f0; border-radius:10px; padding:14px; cursor:pointer; transition:all .2s; }\n      .maq-preset-card:hover { border-color:#3b82f6; box-shadow:0 4px 12px rgba(59,130,246,.15); transform:translateY(-1px); }\n      .maq-preset-card h4 { margin:0 0 4px; font-size:14px; color:#1e293b; }\n      .maq-preset-card small { color:#64748b; font-size:12px; }\n      .maq-preset-card .maq-badge { display:inline-block; background:#dbeafe; color:#1d4ed8; border-radius:6px; padding:2px 8px; font-size:11px; font-weight:600; margin-bottom:6px; }\n      .maq-list-table { width:100%; border-collapse:collapse; }\n      .maq-list-table th { background:#f1f5f9; padding:10px 12px; text-align:left; font-size:12px; color:#64748b; text-transform:uppercase; }\n      .maq-list-table td { padding:11px 12px; border-top:1px solid #f1f5f9; font-size:13px; }\n      .maq-list-table tr:hover td { background:#f8fafc; }\n      .status-badge { padding:3px 10px; border-radius:12px; font-size:11px; font-weight:600; }\n      .status-ativo { background:#dcfce7; color:#166534; }\n      .status-manutencao { background:#fef3c7; color:#92400e; }\n      .status-inativo { background:#fee2e2; color:#991b1b; }\n    </style>\n\n    \x3c!-- KPIs --\x3e\n    <div class="maq-kpi">\n      <div class="card"><div class="big">${e.length}</div><small>Total cadastrado</small></div>\n      <div class="card"><div class="big" style="color:#10b981">${e.filter(a=>!a.status||"ativo"===a.status).length}</div><small>Ativas</small></div>\n      <div class="card"><div class="big" style="color:#f59e0b">${e.filter(a=>"manutencao"===a.status).length}</div><small>Em Manuten√ß√£o</small></div>\n      <div class="card"><div class="big" style="color:#6366f1">${e.reduce((a,e)=>a+Number(e.horimetro||0),0).toLocaleString("pt-BR")}</div><small>Horas Totais</small></div>\n    </div>\n\n    \x3c!-- Formul√°rio cadastro --\x3e\n    <div class="section">\n      <div class="card">\n        <h3>‚ûï Cadastrar M√°quina / Equipamento</h3>\n        <div class="help">Selecione um modelo pr√©-carregado ou preencha manualmente.</div>\n        <div class="hr"></div>\n\n        <h4 style="margin:0 0 10px; color:#475569;">üìã Modelos Pr√©-carregados ‚Äî clique para preencher</h4>\n        <div class="maq-tabs" id="maqTabs">\n          ${o.map((a,e)=>`<div class="maq-tab ${0===e?"active":""}" data-grupo="${e}">${a.grupo}</div>`).join("")}\n        </div>\n        <div id="maqPresets" class="maq-presets">\n          ${o[0].itens.map(a=>`\n            <div class="maq-preset-card" onclick="preencherMaquina('${escapeHtml(a.nome)}','${escapeHtml(a.marca)}','${escapeHtml(a.modelo)}',${a.cap},'${escapeHtml(a.obs)}')">\n              <div class="maq-badge">${o[0].grupo}</div>\n              <h4>${escapeHtml(a.nome)}</h4>\n              <small>üè∑Ô∏è ${escapeHtml(a.marca)} ${escapeHtml(a.modelo)}</small><br>\n              <small style="color:#94a3b8;">${escapeHtml(a.obs)}</small>\n            </div>\n          `).join("")}\n        </div>\n\n        <div class="hr"></div>\n        <form id="frmMaq" class="formGrid">\n          <div><small>üè∑Ô∏è Nome / Tipo *</small><input class="input" id="maqNome" name="nome" required placeholder="Ex: Trator New Holland TL5.90"></div>\n          <div><small>üè≠ Marca</small><input class="input" id="maqMarca" name="marca" placeholder="John Deere, New Holland..."></div>\n          <div><small>üìê Modelo</small><input class="input" id="maqModelo" name="modelo" placeholder="S780, Uniport 4530..."></div>\n          <div><small>üî¢ Placa / N¬∫ S√©rie / Patrim√¥nio</small><input class="input" id="maqPlaca" name="placa"></div>\n          <div><small>üìÖ Ano de Fabrica√ß√£o</small><input class="input" id="maqAno" name="ano" type="number" min="1980" max="2030" placeholder="${(new Date).getFullYear()}"></div>\n          <div><small>‚è±Ô∏è Hor√≠metro Atual (h)</small><input class="input" id="maqHorimetro" name="horimetro" type="number" min="0" placeholder="0"></div>\n          <div><small>üíß Capacidade (L) ‚Äî tanque/pulverizador</small><input class="input" id="maqCap" name="capacidadeL" type="number" min="0" placeholder="0"></div>\n          <div><small>üîß Bicos / Barra / Configura√ß√£o</small><input class="input" id="maqBicos" name="bicos" placeholder="Barra 30m / Leque 11002..."></div>\n          <div><small>üìä Status</small>\n            <select class="select" id="maqStatus" name="status">\n              <option value="ativo">‚úÖ Ativo</option>\n              <option value="manutencao">üîß Em Manuten√ß√£o</option>\n              <option value="inativo">‚ùå Inativo</option>\n            </select>\n          </div>\n          <div class="full"><small>üìù Observa√ß√µes</small><textarea class="input" id="maqObs" name="obs" rows="2" placeholder="Detalhes adicionais, hist√≥rico, etc."></textarea></div>\n          <div class="full row" style="justify-content:flex-end; gap:10px;">\n            <button type="button" class="btn" onclick="document.getElementById('frmMaq').reset(); document.getElementById('editMaqId').value='';">Limpar</button>\n            <button type="submit" class="btn primary" id="btnSalvarMaq">Salvar M√°quina</button>\n          </div>\n        </form>\n        <input type="hidden" id="editMaqId" value="">\n      </div>\n    </div>\n\n    \x3c!-- Tabela de m√°quinas cadastradas --\x3e\n    <div class="section">\n      <div class="card">\n        <h3>üöú M√°quinas Cadastradas (${e.length})</h3>\n        <div style="overflow-x:auto;">\n          <table class="maq-list-table" id="tblMaq">\n            <thead><tr>\n              <th>M√°quina</th><th>Marca / Modelo</th><th>Placa/S√©rie</th>\n              <th>Ano</th><th>Hor√≠metro</th><th>Capacidade</th><th>Status</th><th>A√ß√µes</th>\n            </tr></thead>\n            <tbody id="tbodyMaq">\n              ${0===e.length?'<tr><td colspan="8" style="text-align:center; color:#94a3b8; padding:30px;">Nenhuma m√°quina cadastrada. Use o formul√°rio acima.</td></tr>':e.map(a=>`\n                  <tr>\n                    <td><b>${escapeHtml(a.nome||"")}</b>${a.bicos?`<br><small style="color:#64748b;">${escapeHtml(a.bicos)}</small>`:""}</td>\n                    <td>${escapeHtml(a.marca||"-")} ${escapeHtml(a.modelo||"")}</td>\n                    <td>${escapeHtml(a.placa||"-")}</td>\n                    <td>${a.ano||"-"}</td>\n                    <td>${a.horimetro?num(a.horimetro,0)+" h":"-"}</td>\n                    <td>${a.capacidadeL?num(a.capacidadeL,0)+" L":"-"}</td>\n                    <td><span class="status-badge status-${a.status||"ativo"}">${"manutencao"===a.status?"Manuten√ß√£o":"inativo"===a.status?"Inativo":"Ativo"}</span></td>\n                    <td style="white-space:nowrap;">\n                      <button class="btn" style="padding:4px 10px; font-size:12px;" onclick="editarMaquina('${a.id}')">‚úèÔ∏è</button>\n                      <button class="btn" style="padding:4px 10px; font-size:12px; background:#fee2e2; color:#991b1b;" onclick="deletarMaquina('${a.id}')">üóëÔ∏è</button>\n                    </td>\n                  </tr>\n                `).join("")}\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  `;const t=document.getElementById("maqTabs"),n=document.getElementById("maqPresets");t.addEventListener("click",a=>{const e=a.target.closest(".maq-tab");if(!e)return;t.querySelectorAll(".maq-tab").forEach(a=>a.classList.remove("active")),e.classList.add("active");const l=Number(e.dataset.grupo),r=o[l];n.innerHTML=r.itens.map(a=>`\n      <div class="maq-preset-card" onclick="preencherMaquina('${escapeHtml(a.nome)}','${escapeHtml(a.marca)}','${escapeHtml(a.modelo)}',${a.cap},'${escapeHtml(a.obs)}')">\n        <div class="maq-badge">${r.grupo}</div>\n        <h4>${escapeHtml(a.nome)}</h4>\n        <small>üè∑Ô∏è ${escapeHtml(a.marca)} ${escapeHtml(a.modelo)}</small><br>\n        <small style="color:#94a3b8;">${escapeHtml(a.obs)}</small>\n      </div>\n    `).join("")}),window.preencherMaquina=(a,e,o,t,n)=>{document.getElementById("maqNome").value=a+(o?" "+o:""),document.getElementById("maqMarca").value=e,document.getElementById("maqModelo").value=o,document.getElementById("maqCap").value=t||"",document.getElementById("maqObs").value=n,document.getElementById("frmMaq").scrollIntoView({behavior:"smooth",block:"nearest"})},document.getElementById("frmMaq").addEventListener("submit",a=>{a.preventDefault();const e=new FormData(a.target),o=document.getElementById("editMaqId").value,t=getDB();t.maquinas=t.maquinas||[];const n={id:o||uid("maq"),safraId:getSafraId(),nome:e.get("nome")||"",marca:e.get("marca")||"",modelo:e.get("modelo")||"",placa:e.get("placa")||"",ano:e.get("ano")?Number(e.get("ano")):null,horimetro:Number(e.get("horimetro")||0),capacidadeL:Number(e.get("capacidadeL")||0),bicos:e.get("bicos")||"",status:e.get("status")||"ativo",obs:e.get("obs")||""};if(o){const a=t.maquinas.findIndex(a=>a.id===o);a>=0&&(t.maquinas[a]=n)}else t.maquinas.push(n);setDB(t),toast("Salvo",`M√°quina "${n.nome}" ${o?"atualizada":"cadastrada"}.`),document.getElementById("editMaqId").value="",pageMaquinas()}),window.editarMaquina=a=>{const e=(getDB().maquinas||[]).find(e=>e.id===a);e&&(document.getElementById("editMaqId").value=a,document.getElementById("maqNome").value=e.nome||"",document.getElementById("maqMarca").value=e.marca||"",document.getElementById("maqModelo").value=e.modelo||"",document.getElementById("maqPlaca").value=e.placa||"",document.getElementById("maqAno").value=e.ano||"",document.getElementById("maqHorimetro").value=e.horimetro||0,document.getElementById("maqCap").value=e.capacidadeL||0,document.getElementById("maqBicos").value=e.bicos||"",document.getElementById("maqStatus").value=e.status||"ativo",document.getElementById("maqObs").value=e.obs||"",document.getElementById("btnSalvarMaq").textContent="üíæ Atualizar M√°quina",document.getElementById("frmMaq").scrollIntoView({behavior:"smooth"}))},window.deletarMaquina=a=>{if(!confirm("Remover esta m√°quina?"))return;const e=getDB();e.maquinas=(e.maquinas||[]).filter(e=>e.id!==a),setDB(e),toast("Removido","M√°quina removida."),pageMaquinas()},document.getElementById("btnExportMaq").addEventListener("click",()=>{const a=onlySafra(getDB().maquinas||[]).map(a=>({Nome:a.nome,Marca:a.marca||"",Modelo:a.modelo||"",Placa:a.placa||"",Ano:a.ano||"",Horimetro_h:a.horimetro||0,Capacidade_L:a.capacidadeL||0,Bicos:a.bicos||"",Status:a.status||"ativo",Obs:a.obs||""}));downloadText(`maquinas-${nowISO()}.csv`,toCSV(a)),toast("Exportado","CSV baixado.")})}