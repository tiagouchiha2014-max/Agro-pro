function pageConfiguracoes(){const a=getDB().parametros||{precoSoja:120,produtividadeMinSoja:65,produtividadeMaxSoja:75,precoMilho:60,produtividadeMinMilho:100,produtividadeMaxMilho:130,precoSorgo:42,produtividadeMinSorgo:70,produtividadeMaxSorgo:100,precoFeijao:280,produtividadeMinFeijao:25,produtividadeMaxFeijao:40,precoTrigo:85,produtividadeMinTrigo:40,produtividadeMaxTrigo:60,precoArroz:60,produtividadeMinArroz:60,produtividadeMaxArroz:80,precoCafe:1200,produtividadeMinCafe:20,produtividadeMaxCafe:40,precoCanola:140,produtividadeMinCanola:40,produtividadeMaxCanola:65,precoGirassol:90,produtividadeMinGirassol:35,produtividadeMaxGirassol:55,precoAmendoim:220,produtividadeMinAmendoim:60,produtividadeMaxAmendoim:100,pesoPadraoSaca:60};setTopActions('\n    <button class="btn" id="btnImport">ğŸ“¥ Importar Backup</button>\n    <button class="btn primary" id="btnExport">ğŸ“¤ Exportar Backup</button>\n  ');const n=document.getElementById("content"),e="function"==typeof isSupabaseReady&&isSupabaseReady(),o="admin"===userRole?`\n    <div class="cfg-card page-enter">\n      <div class="cfg-card-header">\n        <span class="cfg-card-icon">ğŸ’</span>\n        <div>\n          <h3 class="cfg-card-title">Plano &amp; Assinatura</h3>\n          <p class="cfg-card-sub">Gerencie seu plano e acesse todos os recursos do Agro Pro</p>\n        </div>\n      </div>\n\n      \x3c!-- Banner do plano atual --\x3e\n      <div class="plan-hero">\n        <div>\n          <div class="plan-hero-label">Seu plano atual</div>\n          <div class="plan-hero-name">\n            ${planoAtual}${"Pro"===planoAtual?" â­":"Master"===planoAtual?" ğŸ‘‘":""}\n          </div>\n          <div class="plan-hero-desc">\n            ${"Free"===planoAtual?"Acesso gratuito limitado â€” faÃ§a upgrade para desbloquear todas as funcionalidades":"Assinatura ativa â€” obrigado por confiar no Agro Pro!"}\n          </div>\n        </div>\n        ${"Free"===planoAtual?'\n          <a href="https://wa.me/5599991360547?text=Ol%C3%A1!%20Quero%20assinar%20o%20Agro%20Pro%20(Plano%20Pro%20R%24199%2Fm%C3%AAs)"\n             target="_blank" class="plan-hero-cta">â¬† Fazer Upgrade</a>':""}\n      </div>\n\n      \x3c!-- Cards dos planos --\x3e\n      <div class="plan-grid">\n\n        \x3c!-- FREE --\x3e\n        <div class="plan-card ${"Free"===planoAtual?"plan-card--current":""}">\n          <div class="plan-card-name plan-card-name--free">FREE</div>\n          <div class="plan-card-price">R$ 0<small>/mÃªs</small></div>\n          <ul class="plan-card-features">\n            <li class="feat-ok">1 fazenda e 1 talhÃ£o</li>\n            <li class="feat-ok">VisualizaÃ§Ã£o completa</li>\n            <li class="feat-no">Estoque e aplicaÃ§Ãµes</li>\n            <li class="feat-no">RelatÃ³rios e IA</li>\n          </ul>\n          <div class="plan-card-badge plan-card-badge--neutral">\n            ${"Free"===planoAtual?"âœ“ PLANO ATUAL":"GRATUITO"}\n          </div>\n        </div>\n\n        \x3c!-- PRO --\x3e\n        <div class="plan-card plan-card--featured ${"Pro"===planoAtual?"plan-card--active":""}">\n          <div class="plan-card-popular">â­ MAIS POPULAR</div>\n          <div class="plan-card-name plan-card-name--pro">PRO</div>\n          <div class="plan-card-price">R$ 199<small>/mÃªs</small></div>\n          <ul class="plan-card-features">\n            <li class="feat-ok">5 fazendas Â· talhÃµes ilimitados</li>\n            <li class="feat-ok">AplicaÃ§Ãµes, estoque, colheitas</li>\n            <li class="feat-ok">Equipe (15) e mÃ¡quinas</li>\n            <li class="feat-ok">RelatÃ³rios + IA Copilot</li>\n          </ul>\n          ${"Pro"===planoAtual?'<div class="plan-card-badge plan-card-badge--success">âœ“ PLANO ATIVO</div>':'<a href="https://wa.me/5599991360547?text=Ol%C3%A1!%20Quero%20assinar%20o%20Agro%20Pro%20(Plano%20Pro%20R%24199%2Fm%C3%AAs)"\n                target="_blank" class="plan-card-cta plan-card-cta--pro">\n                ğŸ’¬ Assinar Pro â€” R$199/mÃªs\n               </a>'}\n        </div>\n\n        \x3c!-- MASTER --\x3e\n        <div class="plan-card plan-card--premium ${"Master"===planoAtual?"plan-card--active-gold":""}">\n          <div class="plan-card-popular plan-card-popular--gold">ğŸ‘‘ ILIMITADO</div>\n          <div class="plan-card-name plan-card-name--master">MASTER</div>\n          <div class="plan-card-price">R$ 299<small>/mÃªs</small></div>\n          <ul class="plan-card-features">\n            <li class="feat-ok">Fazendas <b>ilimitadas</b></li>\n            <li class="feat-ok">Equipe e admins ilimitados</li>\n            <li class="feat-ok">Tudo do Pro incluso</li>\n            <li class="feat-ok">Suporte prioritÃ¡rio 24h</li>\n          </ul>\n          ${"Master"===planoAtual?'<div class="plan-card-badge plan-card-badge--gold">âœ“ PLANO ATIVO</div>':'<a href="https://wa.me/5599991360547?text=Ol%C3%A1!%20Quero%20assinar%20o%20Agro%20Pro%20(Plano%20Master%20R%24299%2Fm%C3%AAs)"\n                target="_blank" class="plan-card-cta plan-card-cta--master">\n                ğŸ’¬ Assinar Master â€” R$299/mÃªs\n               </a>'}\n        </div>\n      </div>\n\n      \x3c!-- Como ativar â€” mensagem de ativaÃ§Ã£o profissional --\x3e\n      <div class="activation-notice">\n        <div class="activation-notice-title">\n          <span>ğŸ“‹</span> Como ativar seu plano\n        </div>\n        <ol class="activation-steps">\n          <li>Escolha seu plano acima e clique em <strong>Assinar</strong></li>\n          <li>Conclua o pagamento via WhatsApp com nossa equipe de suporte</li>\n          <li>\n            <strong>Em alguns minutos, seu plano estarÃ¡ ativo</strong> e todas as\n            funcionalidades serÃ£o liberadas automaticamente â€” sem necessidade de\n            reconfiguraÃ§Ã£o\n          </li>\n        </ol>\n        <div class="activation-contacts">\n          <a href="https://wa.me/5599991360547?text=Ol%C3%A1!%20Preciso%20de%20ajuda%20com%20minha%20assinatura%20do%20Agro%20Pro"\n             target="_blank" class="activation-btn activation-btn--whatsapp">\n            ğŸ’¬ WhatsApp: (99) 99136-0547\n          </a>\n          <a href="mailto:suporteagropro@gmail.com?subject=Assinatura%20Agro%20Pro"\n             class="activation-btn activation-btn--email">\n            ğŸ“§ suporteagropro@gmail.com\n          </a>\n        </div>\n      </div>\n    </div>\n  `:"",r="funcionario"!==userRole?'\n    <div class="cfg-card page-enter">\n      <div class="cfg-card-header">\n        <span class="cfg-card-icon">ğŸ¤–</span>\n        <div>\n          <h3 class="cfg-card-title">InteligÃªncia Artificial â€” Agro-Copilot</h3>\n          <p class="cfg-card-sub">IA integrada via servidor seguro (Edge Function)</p>\n        </div>\n      </div>\n\n      <div class="cfg-ia-status" style="margin-bottom:16px;">\n        <span class="tag tag-success">ğŸ”’ IA protegida no servidor</span>\n        <span style="color:var(--text-muted); font-size:13px; margin-left:8px;">Chave OpenAI gerenciada no backend â€” nunca exposta no navegador.</span>\n      </div>\n\n      <div style="padding:12px 14px; background:var(--info-bg,#eff6ff); border-radius:8px; border-left:3px solid var(--info,#3b82f6);">\n        <p style="margin:0; font-size:12.5px; color:var(--info-text,#1e40af); line-height:1.7;">\n          ğŸ›¡ï¸ <strong>SeguranÃ§a:</strong> O Agro-Copilot usa um proxy seguro no servidor (Supabase Edge Function)\n          para acessar a OpenAI. Sua chave API nunca Ã© armazenada no navegador.<br>\n          ğŸ“Š <strong>Limite:</strong> 20 consultas por hora por usuÃ¡rio (planos Pro e Master).<br>\n          ğŸ’¬ Acesse o <a href="copilot.html" style="color:var(--brand);">Agro-Copilot</a> para conversar com a IA.\n        </p>\n      </div>\n    </div>\n  ':"",s="admin"===userRole?`\n    <div class="cfg-card page-enter">\n      <div class="cfg-card-header">\n        <span class="cfg-card-icon">ğŸ¢</span>\n        <div>\n          <h3 class="cfg-card-title">Dados da Empresa / Propriedade</h3>\n          <p class="cfg-card-sub">InformaÃ§Ãµes que aparecem no cabeÃ§alho dos relatÃ³rios em PDF</p>\n        </div>\n      </div>\n      <form id="frmEmpresa" class="formGrid">\n        <div class="form-group">\n          <small>ğŸ¢ Nome da Empresa / Propriedade *</small>\n          <input class="input" name="nomeEmpresa" value="${escapeHtml(a.nomeEmpresa||"")}" placeholder="Ex: Fazenda Santa Maria Ltda">\n        </div>\n        <div class="form-group">\n          <small>ğŸ“ CNPJ / CPF</small>\n          <input class="input" name="cnpjEmpresa" value="${escapeHtml(a.cnpjEmpresa||"")}" placeholder="Ex: 12.345.678/0001-99">\n        </div>\n        <div class="form-group">\n          <small>ğŸ“ EndereÃ§o</small>\n          <input class="input" name="enderecoEmpresa" value="${escapeHtml(a.enderecoEmpresa||"")}" placeholder="Ex: Rodovia MT-010, Km 42, Sorriso-MT">\n        </div>\n        <div class="form-group">\n          <small>ğŸ“± Telefone</small>\n          <input class="input" name="telefoneEmpresa" value="${escapeHtml(a.telefoneEmpresa||"")}" placeholder="Ex: (66) 99999-0000">\n        </div>\n        <div class="full" style="display:flex; justify-content:flex-end; margin-top:var(--space-2);">\n          <button class="btn primary" type="submit">ğŸ’¾ Salvar dados da empresa</button>\n        </div>\n      </form>\n    </div>\n  `:"",t=(a,n,e,o,r,s,t,i,d)=>`\n    <div class="cfg-crop-group">\n      <div class="cfg-crop-label" style="color:${e};">${a} ${n}</div>\n      <div class="formGrid" style="grid-template-columns:repeat(3,1fr);">\n        <div class="form-group">\n          <small>PreÃ§o (R$/sc)</small>\n          <input class="input" name="${o}" value="${t}">\n        </div>\n        <div class="form-group">\n          <small>Prod. mÃ­n. (sc/ha)</small>\n          <input class="input" name="${r}" value="${i}">\n        </div>\n        <div class="form-group">\n          <small>Prod. mÃ¡x. (sc/ha)</small>\n          <input class="input" name="${s}" value="${d}">\n        </div>\n      </div>\n    </div>\n  `,i="admin"===userRole?`\n    <div class="cfg-card page-enter">\n      <div class="cfg-card-header">\n        <span class="cfg-card-icon">âš™ï¸</span>\n        <div>\n          <h3 class="cfg-card-title">ParÃ¢metros de Mercado</h3>\n          <p class="cfg-card-sub">PreÃ§os e produtividades utilizados nos cÃ¡lculos de custo e rentabilidade</p>\n        </div>\n      </div>\n      <form id="frmParams">\n        ${t("ğŸŒ±","Soja","var(--brand)","precoSoja","prodMinSoja","prodMaxSoja",a.precoSoja||120,a.produtividadeMinSoja||65,a.produtividadeMaxSoja||75)}\n        ${t("ğŸŒ½","Milho","var(--warning)","precoMilho","prodMinMilho","prodMaxMilho",a.precoMilho||60,a.produtividadeMinMilho||100,a.produtividadeMaxMilho||130)}\n        ${t("ğŸŒ¾","Sorgo","var(--neutral)","precoSorgo","prodMinSorgo","prodMaxSorgo",a.precoSorgo||42,a.produtividadeMinSorgo||70,a.produtividadeMaxSorgo||100)}\n        ${t("ğŸ«˜","FeijÃ£o","var(--info)","precoFeijao","prodMinFeijao","prodMaxFeijao",a.precoFeijao||280,a.produtividadeMinFeijao||25,a.produtividadeMaxFeijao||40)}\n        ${t("ğŸŒ¾","Trigo","var(--text-muted)","precoTrigo","prodMinTrigo","prodMaxTrigo",a.precoTrigo||85,a.produtividadeMinTrigo||40,a.produtividadeMaxTrigo||60)}\n        ${t("ğŸš","Arroz","var(--success)","precoArroz","prodMinArroz","prodMaxArroz",a.precoArroz||60,a.produtividadeMinArroz||60,a.produtividadeMaxArroz||80)}\n        ${t("â˜•","CafÃ©","var(--accent)","precoCafe","prodMinCafe","prodMaxCafe",a.precoCafe||1200,a.produtividadeMinCafe||20,a.produtividadeMaxCafe||40)}\n        ${t("ğŸŒ¼","Canola","var(--success-light,var(--success))","precoCanola","prodMinCanola","prodMaxCanola",a.precoCanola||140,a.produtividadeMinCanola||40,a.produtividadeMaxCanola||65)}\n        ${t("ğŸŒ»","Girassol","var(--warning)","precoGirassol","prodMinGirassol","prodMaxGirassol",a.precoGirassol||90,a.produtividadeMinGirassol||35,a.produtividadeMaxGirassol||55)}\n        ${t("ğŸ¥œ","Amendoim","var(--accent)","precoAmendoim","prodMinAmendoim","prodMaxAmendoim",a.precoAmendoim||220,a.produtividadeMinAmendoim||60,a.produtividadeMaxAmendoim||100)}\n        <div class="cfg-crop-group">\n          <div class="cfg-crop-label" style="color:var(--text-secondary);">âš™ï¸ Geral</div>\n          <div class="formGrid" style="grid-template-columns:repeat(3,1fr);">\n            <div class="form-group">\n              <small>Peso padrÃ£o da saca (kg)</small>\n              <input class="input" name="pesoPadraoSaca" value="${a.pesoPadraoSaca||60}">\n            </div>\n          </div>\n        </div>\n        <div style="display:flex; justify-content:flex-end; margin-top:var(--space-4);">\n          <button class="btn primary" type="submit">ğŸ’¾ Salvar parÃ¢metros</button>\n        </div>\n      </form>\n    </div>\n  `:"",d="admin"===userRole?'\n    <div class="cfg-card page-enter">\n      <div class="cfg-card-header">\n        <span class="cfg-card-icon">ğŸ’¾</span>\n        <div>\n          <h3 class="cfg-card-title">Backup e RestauraÃ§Ã£o</h3>\n          <p class="cfg-card-sub">Exporte ou importe todos os dados da conta em formato JSON</p>\n        </div>\n      </div>\n      <div style="display:flex; gap:var(--space-3); flex-wrap:wrap;">\n        <button class="btn primary" id="btnExport2">ğŸ“¤ Exportar Backup</button>\n        <button class="btn" id="btnImport2">ğŸ“¥ Importar Backup</button>\n      </div>\n    </div>\n  ':"",c="admin"===userRole?'\n    <div class="cfg-card page-enter">\n      <div class="cfg-card-header">\n        <span class="cfg-card-icon">âš ï¸</span>\n        <div>\n          <h3 class="cfg-card-title">Reset de Dados</h3>\n          <p class="cfg-card-sub">OperaÃ§Ãµes irreversÃ­veis â€” use com cautela</p>\n        </div>\n      </div>\n      <div style="display:flex; gap:var(--space-3); flex-wrap:wrap; margin-bottom:var(--space-4);">\n        <button class="btn warning" id="btnZerarDados">ğŸ§¹ Zerar todos os dados</button>\n        <button class="btn" id="btnRestaurarDemo">ğŸ”„ Restaurar demonstraÃ§Ã£o</button>\n      </div>\n      <p class="help">\n        <strong>Zerar dados:</strong> remove fazendas, talhÃµes, produtos, estoque, etc., mantendo apenas a safra atual.<br>\n        <strong>Restaurar demo:</strong> recria o banco com dados de exemplo para testes.\n      </p>\n    </div>\n  ':"",l=`\n    <div class="cfg-card page-enter">\n      <div class="cfg-card-header">\n        <span class="cfg-card-icon">â˜ï¸</span>\n        <div>\n          <h3 class="cfg-card-title">SincronizaÃ§Ã£o na Nuvem</h3>\n          <p class="cfg-card-sub">Status: <b id="cloudStatusText">${e?"âœ… Conectado ao Supabase":"âš ï¸ Modo Offline"}</b></p>\n        </div>\n      </div>\n      <p class="help" style="margin-bottom:var(--space-4);">\n        Seus dados sÃ£o sincronizados automaticamente a cada alteraÃ§Ã£o. Use as opÃ§Ãµes abaixo para forÃ§ar sincronizaÃ§Ã£o manual.\n      </p>\n      <div style="display:flex; gap:var(--space-3); flex-wrap:wrap;">\n        <button class="btn primary" id="btnForceSync">â˜ï¸ Sincronizar Agora</button>\n        <button class="btn" id="btnForceRestore">ğŸ“¥ Restaurar da Nuvem</button>\n      </div>\n    </div>\n  `,p=`\n    <div class="cfg-card page-enter">\n      <div class="cfg-card-header">\n        <span class="cfg-card-icon">ğŸ‘¤</span>\n        <div>\n          <h3 class="cfg-card-title">Conta</h3>\n          <p class="cfg-card-sub">${escapeHtml(userSession?.user?.email||"UsuÃ¡rio nÃ£o identificado")}</p>\n        </div>\n      </div>\n      <div style="display:flex; gap:var(--space-3); align-items:center; flex-wrap:wrap;">\n        <span class="tag tag-${"Pro"===planoAtual?"success":"Master"===planoAtual?"warning":"neutral"}">${planoAtual}</span>\n        <span class="tag tag-info">${getRoleLabel()}</span>\n        <button class="btn" id="btnLogout" style="margin-left:auto;">ğŸšª Sair da Conta</button>\n      </div>\n    </div>\n  `;n.innerHTML=`\n    <style>\n      /* â”€â”€ Config cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n      .cfg-card {\n        background: var(--surface);\n        border: 1px solid var(--border);\n        border-radius: var(--radius);\n        padding: var(--space-6);\n        margin-bottom: var(--space-5);\n        box-shadow: var(--shadow-sm);\n        transition: box-shadow var(--t-base);\n      }\n      .cfg-card-header {\n        display: flex;\n        align-items: flex-start;\n        gap: var(--space-4);\n        margin-bottom: var(--space-5);\n        padding-bottom: var(--space-4);\n        border-bottom: 1px solid var(--border);\n      }\n      .cfg-card-icon {\n        font-size: 22px;\n        line-height: 1;\n        margin-top: 2px;\n        flex-shrink: 0;\n      }\n      .cfg-card-title {\n        font-size: 15px;\n        font-weight: 700;\n        color: var(--text);\n        margin: 0 0 3px;\n      }\n      .cfg-card-sub {\n        font-size: 12.5px;\n        color: var(--text-muted);\n        margin: 0;\n      }\n\n      /* â”€â”€ Plan hero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n      .plan-hero {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: var(--space-5);\n        flex-wrap: wrap;\n        background: linear-gradient(135deg, var(--sidebar-bg) 0%, #1e3a1e 100%);\n        border-radius: var(--radius);\n        padding: var(--space-5) var(--space-6);\n        margin-bottom: var(--space-5);\n      }\n      .plan-hero-label {\n        font-size: 11px;\n        color: rgba(255,255,255,.5);\n        font-weight: 600;\n        text-transform: uppercase;\n        letter-spacing: .5px;\n        margin-bottom: 6px;\n      }\n      .plan-hero-name {\n        font-size: 26px;\n        font-weight: 800;\n        color: #fff;\n        letter-spacing: -.5px;\n        line-height: 1;\n        margin-bottom: 6px;\n      }\n      .plan-hero-desc {\n        font-size: 12.5px;\n        color: rgba(255,255,255,.5);\n      }\n      .plan-hero-cta {\n        background: var(--brand-light);\n        color: #fff;\n        padding: 11px 22px;\n        border-radius: var(--radius-sm);\n        font-weight: 700;\n        font-size: 13.5px;\n        text-decoration: none;\n        white-space: nowrap;\n        box-shadow: var(--shadow-brand);\n        transition: opacity var(--t-fast);\n        flex-shrink: 0;\n      }\n      .plan-hero-cta:hover { opacity: .9; }\n\n      /* â”€â”€ Plan grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n      .plan-grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));\n        gap: var(--space-4);\n        margin-bottom: var(--space-5);\n      }\n      .plan-card {\n        padding: var(--space-5);\n        border-radius: var(--radius);\n        border: 2px solid var(--border);\n        background: var(--surface);\n        position: relative;\n        transition: transform var(--t-base), box-shadow var(--t-base);\n      }\n      .plan-card:hover {\n        transform: translateY(-3px);\n        box-shadow: var(--shadow-md);\n      }\n      .plan-card--current  { border-color: var(--border-medium); background: var(--neutral-bg); }\n      .plan-card--featured { border-color: var(--success); }\n      .plan-card--active   { background: var(--success-bg); }\n      .plan-card--premium  { border-color: var(--warning); }\n      .plan-card--active-gold { background: var(--accent-subtle); }\n\n      .plan-card-popular {\n        position: absolute;\n        top: -11px; left: 50%;\n        transform: translateX(-50%);\n        background: var(--success);\n        color: #fff;\n        padding: 2px 14px;\n        border-radius: 999px;\n        font-size: 10px;\n        font-weight: 700;\n        white-space: nowrap;\n        letter-spacing: .5px;\n      }\n      .plan-card-popular--gold { background: var(--warning); }\n\n      .plan-card-name {\n        font-size: 12px;\n        font-weight: 800;\n        letter-spacing: .6px;\n        margin-bottom: 10px;\n        margin-top: 8px;\n      }\n      .plan-card-name--free   { color: var(--neutral); }\n      .plan-card-name--pro    { color: var(--success); }\n      .plan-card-name--master { color: var(--warning); }\n\n      .plan-card-price {\n        font-size: 28px;\n        font-weight: 800;\n        color: var(--text);\n        letter-spacing: -1px;\n        line-height: 1;\n        margin-bottom: 14px;\n      }\n      .plan-card-price small {\n        font-size: 13px;\n        font-weight: 400;\n        color: var(--text-muted);\n      }\n\n      .plan-card-features {\n        list-style: none;\n        padding: 0; margin: 0 0 16px;\n        font-size: 12.5px;\n        color: var(--text-secondary);\n        line-height: 2;\n      }\n      .feat-ok::before { content: 'âœ“ '; color: var(--success); font-weight: 700; }\n      .feat-no { opacity: .45; }\n      .feat-no::before { content: 'âœ— '; }\n\n      .plan-card-badge {\n        padding: 7px;\n        border-radius: var(--radius-sm);\n        text-align: center;\n        font-size: 11px;\n        font-weight: 700;\n        letter-spacing: .5px;\n      }\n      .plan-card-badge--neutral { background: var(--neutral-bg); color: var(--neutral); }\n      .plan-card-badge--success { background: var(--success-bg); border: 1px solid var(--success); color: var(--success); }\n      .plan-card-badge--gold    { background: var(--accent-subtle); border: 1px solid var(--warning); color: var(--warning); }\n\n      .plan-card-cta {\n        display: block;\n        padding: 9px;\n        border-radius: var(--radius-sm);\n        font-weight: 700;\n        font-size: 13px;\n        text-decoration: none;\n        text-align: center;\n        transition: opacity var(--t-fast);\n      }\n      .plan-card-cta:hover { opacity: .88; }\n      .plan-card-cta--pro    { background: var(--success); color: #fff; }\n      .plan-card-cta--master { background: var(--warning); color: #fff; }\n\n      /* â”€â”€ Activation notice â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n      .activation-notice {\n        background: var(--info-bg);\n        border: 1px solid rgba(3,105,161,.18);\n        border-left: 3px solid var(--info);\n        border-radius: 0 var(--radius-sm) var(--radius-sm) 0;\n        padding: var(--space-5);\n      }\n      .activation-notice-title {\n        font-size: 13.5px;\n        font-weight: 700;\n        color: var(--info);\n        margin-bottom: var(--space-3);\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      .activation-steps {\n        margin: 0 0 var(--space-4);\n        padding-left: 18px;\n        font-size: 13px;\n        color: var(--text-secondary);\n        line-height: 2.1;\n      }\n      .activation-contacts {\n        display: flex;\n        gap: var(--space-3);\n        flex-wrap: wrap;\n      }\n      .activation-btn {\n        display: inline-flex;\n        align-items: center;\n        gap: 8px;\n        padding: 9px 18px;\n        border-radius: var(--radius-sm);\n        text-decoration: none;\n        font-size: 13px;\n        font-weight: 600;\n        transition: opacity var(--t-fast);\n      }\n      .activation-btn:hover { opacity: .88; }\n      .activation-btn--whatsapp { background: #25d366; color: #fff; }\n      .activation-btn--email    { background: var(--info); color: #fff; }\n\n      /* â”€â”€ Crop groups â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n      .cfg-crop-group {\n        padding: var(--space-3) 0;\n        border-bottom: 1px solid var(--border);\n      }\n      .cfg-crop-group:last-child { border-bottom: none; }\n      .cfg-crop-label {\n        font-size: 12px;\n        font-weight: 700;\n        text-transform: uppercase;\n        letter-spacing: .7px;\n        margin-bottom: var(--space-2);\n      }\n\n      /* â”€â”€ IA status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n      .cfg-ia-status {\n        display: flex;\n        align-items: center;\n        gap: var(--space-4);\n        flex-wrap: wrap;\n        padding: var(--space-3) var(--space-4);\n        background: var(--success-bg);\n        border-radius: var(--radius-sm);\n        border: 1px solid rgba(16,185,129,.2);\n      }\n    </style>\n\n    ${o}\n    ${s}\n    ${r}\n    ${i}\n    ${d}\n    ${c}\n    ${l}\n    ${p}\n  `,"admin"===userRole&&document.getElementById("frmParams").addEventListener("submit",async a=>{a.preventDefault();const n=new FormData(a.target),e=getDB();if(e.parametros={precoSoja:Number(n.get("precoSoja")||120),produtividadeMinSoja:Number(n.get("prodMinSoja")||65),produtividadeMaxSoja:Number(n.get("prodMaxSoja")||75),precoMilho:Number(n.get("precoMilho")||60),produtividadeMinMilho:Number(n.get("prodMinMilho")||100),produtividadeMaxMilho:Number(n.get("prodMaxMilho")||130),precoSorgo:Number(n.get("precoSorgo")||42),produtividadeMinSorgo:Number(n.get("prodMinSorgo")||70),produtividadeMaxSorgo:Number(n.get("prodMaxSorgo")||100),precoFeijao:Number(n.get("precoFeijao")||280),produtividadeMinFeijao:Number(n.get("prodMinFeijao")||25),produtividadeMaxFeijao:Number(n.get("prodMaxFeijao")||40),precoTrigo:Number(n.get("precoTrigo")||85),produtividadeMinTrigo:Number(n.get("prodMinTrigo")||40),produtividadeMaxTrigo:Number(n.get("prodMaxTrigo")||60),precoArroz:Number(n.get("precoArroz")||60),produtividadeMinArroz:Number(n.get("prodMinArroz")||60),produtividadeMaxArroz:Number(n.get("prodMaxArroz")||80),precoCafe:Number(n.get("precoCafe")||1200),produtividadeMinCafe:Number(n.get("prodMinCafe")||20),produtividadeMaxCafe:Number(n.get("prodMaxCafe")||40),precoCanola:Number(n.get("precoCanola")||140),produtividadeMinCanola:Number(n.get("prodMinCanola")||40),produtividadeMaxCanola:Number(n.get("prodMaxCanola")||65),precoGirassol:Number(n.get("precoGirassol")||90),produtividadeMinGirassol:Number(n.get("prodMinGirassol")||35),produtividadeMaxGirassol:Number(n.get("prodMaxGirassol")||55),precoAmendoim:Number(n.get("precoAmendoim")||220),produtividadeMinAmendoim:Number(n.get("prodMinAmendoim")||60),produtividadeMaxAmendoim:Number(n.get("prodMaxAmendoim")||100),pesoPadraoSaca:Number(n.get("pesoPadraoSaca")||60),nomeEmpresa:e.parametros?.nomeEmpresa||"",cnpjEmpresa:e.parametros?.cnpjEmpresa||"",enderecoEmpresa:e.parametros?.enderecoEmpresa||"",telefoneEmpresa:e.parametros?.telefoneEmpresa||""},setDB(e),"undefined"!=typeof SupaCRUD)try{await SupaCRUD.upsertParametros(e.parametros)}catch(a){}toast("ParÃ¢metros salvos","Valores atualizados com sucesso.")}),"admin"===userRole&&document.getElementById("frmEmpresa")&&document.getElementById("frmEmpresa").addEventListener("submit",async a=>{a.preventDefault();const n=new FormData(a.target),e=getDB();if(e.parametros=e.parametros||{},e.parametros.nomeEmpresa=(n.get("nomeEmpresa")||"").trim(),e.parametros.cnpjEmpresa=(n.get("cnpjEmpresa")||"").trim(),e.parametros.enderecoEmpresa=(n.get("enderecoEmpresa")||"").trim(),e.parametros.telefoneEmpresa=(n.get("telefoneEmpresa")||"").trim(),setDB(e),"undefined"!=typeof SupaCRUD)try{await SupaCRUD.upsertParametros(e.parametros)}catch(a){}toast("Empresa salva","Dados da empresa atualizados. SerÃ£o usados nos PDFs.")});const u=()=>{downloadText(`agro-pro-backup-${nowISO()}.json`,JSON.stringify(getDB(),null,2)),toast("Backup exportado","Arquivo .json baixado com sucesso.")};document.getElementById("btnExport").addEventListener("click",u),document.getElementById("btnExport2")?.addEventListener("click",u);const m=()=>{const a=document.createElement("input");a.type="file",a.accept="application/json",a.onchange=async()=>{const n=a.files?.[0];if(!n)return;const e=await n.text();try{const a=JSON.parse(e);if(!a.safras)return void alert("Arquivo invÃ¡lido (nÃ£o contÃ©m safras).");if(!confirm("Importar vai SUBSTITUIR todos os dados locais. Deseja continuar?"))return;Storage.save(a),toast("Importado","Sincronizando com a nuvem..."),"function"==typeof cloudSyncImmediate?cloudSyncImmediate().then(()=>{toast("Sincronizado","Backup enviado para a nuvem!"),setTimeout(()=>location.reload(),500)}).catch(()=>{setTimeout(()=>location.reload(),500)}):setTimeout(()=>location.reload(),500)}catch(a){alert("NÃ£o foi possÃ­vel ler o arquivo JSON.")}},a.click()};document.getElementById("btnImport").addEventListener("click",m),document.getElementById("btnImport2")?.addEventListener("click",m),document.getElementById("btnZerarDados")?.addEventListener("click",()=>{if(!confirm("âš ï¸ Isso vai APAGAR todas as fazendas, talhÃµes, produtos, estoque, aplicaÃ§Ãµes, colheitas, etc. Deseja continuar?"))return;const a=getDB(),n=getSafraId();["fazendas","talhoes","produtos","estoque","equipe","maquinas","clima","dieselEntradas","dieselEstoque","combustivel","aplicacoes","lembretes","pragas","colheitas","manutencoes","insumosBase"].forEach(n=>a[n]=[]),a.dieselEstoque.push({id:uid("dsl"),safraId:n,deposito:"Tanque Principal",litros:0,precoVigente:0,obs:"Estoque zerado"}),setDB(a),toast("Dados zerados","Todos os registros foram removidos."),setTimeout(()=>location.reload(),200)}),document.getElementById("btnRestaurarDemo")?.addEventListener("click",()=>{confirm("âš ï¸ Isso vai SUBSTITUIR todos os dados atuais pelos dados de demonstraÃ§Ã£o. Continuar?")&&(localStorage.removeItem(Storage.key),seedDB(),toast("DemonstraÃ§Ã£o restaurada","Banco de dados recriado com dados de exemplo."),setTimeout(()=>location.reload(),200))}),document.getElementById("btnForceSync")?.addEventListener("click",async()=>{if("function"==typeof cloudSyncImmediate&&"function"==typeof isSupabaseReady&&isSupabaseReady()){toast("Sincronizando","Enviando dados para a nuvem...");try{void 0!==window._lastSyncedHash&&(window._lastSyncedHash=null),await cloudSyncImmediate(),toast("Sucesso","Dados sincronizados com a nuvem!")}catch(a){toast("Erro","Falha ao sincronizar: "+a.message)}}else toast("Offline","Supabase nÃ£o configurado. Verifique a conexÃ£o.")}),document.getElementById("btnForceRestore")?.addEventListener("click",async()=>{if("function"==typeof cloudRestore&&"function"==typeof isSupabaseReady&&isSupabaseReady()){if(confirm("Isso vai SUBSTITUIR seus dados locais pelos dados da nuvem. Continuar?")){toast("Restaurando","Baixando dados da nuvem...");try{await cloudRestore()?(toast("Restaurado","Dados da nuvem carregados! Recarregando..."),setTimeout(()=>location.reload(),500)):toast("Info","Dados locais jÃ¡ estÃ£o atualizados ou nenhum backup encontrado na nuvem.")}catch(a){toast("Erro","Falha ao restaurar: "+a.message)}}}else toast("Offline","Supabase nÃ£o configurado.")}),document.getElementById("btnLogout").addEventListener("click",async()=>{if(confirm("Deseja realmente sair da sua conta?")){toast("Saindo...","Salvando dados na nuvem...");try{"function"==typeof cloudSyncImmediate&&await cloudSyncImmediate()}catch(a){}try{"undefined"!=typeof AuthService&&isSupabaseReady()&&await AuthService.signOut()}catch(a){}["agro_session","agro_role","agro_trial","agro_plano","agro_pro_v10"].forEach(a=>localStorage.removeItem(a)),sessionStorage.clear(),toast("Logout realizado","VocÃª saiu da conta com seguranÃ§a."),setTimeout(()=>{window.location.href="index.html"},500)}})}