function pagePropriedade(a){renderShell("propriedade","üè° Minha Propriedade","Safras, fazendas e talh√µes em um s√≥ lugar");const e=document.getElementById("content"),t=a||localStorage.getItem("prop_tab")||"safras",n=[{key:"safras",icon:"üå±",label:"Safras"},{key:"fazendas",icon:"üåæ",label:"Fazendas"},{key:"talhoes",icon:"üß≠",label:"Talh√µes"}].map(a=>`\n    <button\n      class="prop-tab ${a.key===t?"active":""}"\n      data-tab="${a.key}"\n      style="\n        flex: 1;\n        padding: 11px 16px;\n        border: none;\n        background: ${a.key===t?"var(--brand)":"transparent"};\n        color: ${a.key===t?"#fff":"var(--text-muted)"};\n        font-size: 13.5px;\n        font-weight: ${a.key===t?"700":"500"};\n        font-family: var(--font);\n        cursor: pointer;\n        border-radius: var(--radius-sm);\n        transition: background var(--t-fast), color var(--t-fast);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 7px;\n        white-space: nowrap;\n      "\n    >${a.icon} ${a.label}</button>\n  `).join("");e.innerHTML=`\n    <div class="section page-enter">\n      \x3c!-- Tab bar --\x3e\n      <div style="\n        background: var(--surface);\n        border: 1px solid var(--border);\n        border-radius: var(--radius);\n        padding: 4px;\n        display: flex;\n        gap: 4px;\n        box-shadow: var(--shadow-sm);\n      ">${n}</div>\n\n      \x3c!-- Tab content --\x3e\n      <div id="propContent"></div>\n    </div>\n  `,document.querySelectorAll(".prop-tab").forEach(a=>{a.addEventListener("click",()=>{const e=a.dataset.tab;localStorage.setItem("prop_tab",e),pagePropriedade(e)})}),"safras"===t?_renderSafrasTab():"fazendas"===t?_renderFazendasTab():"talhoes"===t&&_renderTalhoesTab()}function _renderSafrasTab(){const a=document.getElementById("propContent");function e(){const a=getDB(),e=getSafraId(),t=document.getElementById("safrasList");a.safras.length?t.innerHTML=a.safras.slice().reverse().map(t=>`\n      <div style="\n        display:flex; align-items:center; justify-content:space-between;\n        gap:var(--space-4); padding:var(--space-4);\n        border:1px solid ${t.id===e?"var(--brand)":"var(--border)"};\n        background:${t.id===e?"var(--brand-subtle)":"var(--surface)"};\n        border-radius:var(--radius-sm); margin-bottom:var(--space-2);\n        transition: all var(--t-fast);\n      ">\n        <div style="flex:1; min-width:0;">\n          <div style="font-weight:700; font-size:14px; color:var(--text); display:flex; align-items:center; gap:8px;">\n            ${escapeHtml(t.nome)}\n            ${t.id===e?'<span class="tag tag-success" style="font-size:10px;">Ativa</span>':""}\n          </div>\n          <div style="font-size:12px; color:var(--text-muted); margin-top:3px;">\n            ${t.dataInicio?`${t.dataInicio} ‚Üí ${t.dataFim||"em andamento"}`:"Sem datas definidas"}\n            <span style="margin-left:8px; font-size:11px; color:var(--text-muted);">üìä ${(a.fazendas||[]).filter(f=>f.safraId===t.id).length} faz ¬∑ ${(a.talhoes||[]).filter(f=>f.safraId===t.id).length} talh ¬∑ ${(a.aplicacoes||[]).filter(f=>f.safraId===t.id).length} aplic</span>\n            ${t.observacoes?` ¬∑ ${clampStr(t.observacoes,40)}`:""}\n          </div>\n        </div>\n        <div style="display:flex; gap:8px; flex-shrink:0;">\n          ${t.id!==e?`<button class="btn" style="font-size:12px; padding:6px 12px;" onclick="window.__usarSafra('${t.id}')">Ativar</button>`:""}\n          ${a.safras.length>1?`<button class="btn danger" onclick="window.__delSafra('${t.id}')">Excluir</button>`:""}\n        </div>\n      </div>\n    `).join(""):t.innerHTML=emptyState("üå±","Nenhuma safra cadastrada","Crie sua primeira safra para come√ßar a usar o Agro Pro.")}a&&(a.innerHTML=`\n    <div style="display:grid; grid-template-columns:340px 1fr; gap:var(--space-5); align-items:start;">\n\n      \x3c!-- Formul√°rio --\x3e\n      <div class="card">\n        <h3>üå± Nova Safra</h3>\n        <div class="help">Cada safra tem seus pr√≥prios talh√µes, estoque e aplica√ß√µes.</div>\n        <form id="frmSafra" class="formGrid" style="margin-top:var(--space-4);">\n          <div class="form-group full">\n            <small>Nome da safra *</small>\n            <input class="input" name="nome" required placeholder="Ex: Safra 2026/27">\n          </div>\n          <div class="form-group">\n            <small>Data in√≠cio</small>\n            <input class="input" name="dataInicio" type="date" value="${nowISO()}">\n          </div>\n          <div class="form-group">\n            <small>Data fim</small>\n            <input class="input" name="dataFim" type="date">\n          </div>\n          <div class="form-group full">\n            <small>Observa√ß√µes</small>\n            <textarea class="textarea" name="observacoes" rows="2" placeholder="Opcional"></textarea>\n          </div>\n          <div class="full" style="display:flex; justify-content:flex-end;">\n            <button class="btn primary" type="submit">+ Adicionar safra</button>\n          </div>\n        </form>\n      </div>\n\n      \x3c!-- Lista de safras --\x3e\n      <div class="card">\n        <h3>üìã Safras cadastradas</h3>\n        <div id="safrasList"></div>\n      </div>\n    </div>\n\n    \x3c!-- Bot√£o CSV --\x3e\n    <div style="display:flex; justify-content:flex-end; margin-top:var(--space-2);">\n      <button class="btn" id="btnExportSafrasCSV">üì• Exportar CSV</button>\n    </div>\n  `,window.__usarSafra=a=>{setSafraId(a),toast("üå± Safra ativada","Filtrando dados para a safra selecionada."),setTimeout(()=>location.reload(),300)},window.__delSafra=a=>{const e=getDB();e.safras.length<=1?toast("Aten√ß√£o","√â necess√°rio manter pelo menos 1 safra."):confirm("Excluir safra e TODOS os dados dela? (fazendas, talh√µes, aplica√ß√µes)\nEssa a√ß√£o n√£o pode ser desfeita.")&&(e.safras=e.safras.filter(e=>e.id!==a),["fazendas","talhoes","produtos","estoque","equipe","maquinas","clima","aplicacoes","combustivel","dieselEntradas","dieselEstoque","lembretes","pragas","colheitas","manutencoes","insumosBase"].forEach(t=>e[t]=(e[t]||[]).filter(e=>e.safraId!==a)),getSafraId()===a&&(e.session.safraId=e.safras[0].id),setDB(e),toast("Safra exclu√≠da","Todos os dados foram removidos."),setTimeout(()=>location.reload(),300))},document.getElementById("frmSafra").addEventListener("submit",a=>{a.preventDefault();const t=new FormData(a.target),n=getDB(),s={id:uid("saf"),nome:t.get("nome").trim(),dataInicio:t.get("dataInicio")||nowISO(),dataFim:t.get("dataFim")||"",ativa:!0,observacoes:t.get("observacoes")||""};n.safras.push(s),setDB(n),setSafraId(s.id),a.target.reset(),document.querySelector('[name="dataInicio"]').value=nowISO(),toast("üå± Safra criada",`"${s.nome}" est√° ativa agora.`),e()}),document.getElementById("btnExportSafrasCSV").addEventListener("click",()=>{downloadText(`safras-${nowISO()}.csv`,toCSV(getDB().safras)),toast("Exportado","CSV de safras baixado.")}),e())}function _renderFazendasTab(){const a=document.getElementById("propContent");let _fazPageSize=15;function e(){const a=getDB(),e=onlySafra(a.fazendas),t=document.getElementById("fazendasGrid");if(!e.length)return void(t.innerHTML=emptyState("üåæ","Nenhuma fazenda cadastrada","Adicione a primeira fazenda da safra atual.",(canCreateOnPage("fazendas"),"")));const n={};onlySafra(a.talhoes||[]).forEach(a=>{n[a.fazendaId]=(n[a.fazendaId]||0)+1});const _vis=e.slice(0,_fazPageSize);t.innerHTML=_vis.map(a=>`\n      <div class="card" style="padding:var(--space-5); position:relative; overflow:hidden; transition:transform var(--t-base), box-shadow var(--t-base);"\n        onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='var(--shadow-md)'"\n        onmouseout="this.style.transform=''; this.style.boxShadow=''">\n        <div style="position:absolute; right:-8px; top:-8px; font-size:56px; opacity:.05; pointer-events:none;">üåæ</div>\n        <div style="font-size:11px; color:var(--text-muted); font-weight:600; text-transform:uppercase; letter-spacing:.5px; margin-bottom:6px;">\n          ${escapeHtml(a.cidade||"‚Äî")}${a.uf?` ¬∑ ${a.uf.toUpperCase()}`:""}\n        </div>\n        <div style="font-size:17px; font-weight:800; color:var(--text); margin-bottom:10px; line-height:1.2;">${escapeHtml(a.nome)}</div>\n        <div style="display:flex; gap:var(--space-4); flex-wrap:wrap; margin-bottom:var(--space-4);">\n          <div style="text-align:center;">\n            <div style="font-size:20px; font-weight:800; color:var(--brand);">${a.areaHa?num(a.areaHa,0):"‚Äî"}</div>\n            <div style="font-size:10px; color:var(--text-muted); font-weight:600;">hectares</div>\n          </div>\n          <div style="text-align:center;">\n            <div style="font-size:20px; font-weight:800; color:var(--brand);">${n[a.id]||0}</div>\n            <div style="font-size:10px; color:var(--text-muted); font-weight:600;">talh√µes</div>\n          </div>\n        </div>\n        ${a.latitude&&a.longitude?`\n          <a href="https://www.google.com/maps?q=${a.latitude},${a.longitude}" target="_blank"\n            style="font-size:11.5px; color:var(--brand); text-decoration:none; display:flex; align-items:center; gap:4px; margin-bottom:var(--space-3);">\n            üìç Ver no mapa\n          </a>`:""}\n        ${a.observacoes?`<p style="font-size:12px; color:var(--text-muted); margin-bottom:var(--space-3); line-height:1.5;">${escapeHtml(clampStr(a.observacoes,60))}</p>`:""}\n        <div style="display:flex; gap:8px; flex-wrap:wrap;">\n          <button class="btn" style="font-size:12px; padding:6px 12px; flex:1;"\n            onclick="localStorage.setItem('prop_tab','talhoes'); localStorage.setItem('prop_faz_filter','${a.id}'); pagePropriedade('talhoes')">\n            üß≠ Ver talh√µes\n          </button>\n          ${canDeleteOnPage("fazendas")?`<button class="btn danger" onclick="window.__delFaz('${a.id}')">Excluir</button>`:""}\n        </div>\n      </div>\n    `).join("");const _pg=document.getElementById("fazPagination");e.length>_fazPageSize?(_pg.style.display="flex",_pg.innerHTML=`<button class="btn" onclick="window.__fazMore()">Carregar Mais (${Math.min(_fazPageSize,e.length)} de ${e.length})</button>`):_pg&&(_pg.style.display="none")}window.__fazMore=function(){_fazPageSize+=15;e()};a&&(getDB(),getSafraId(),a.innerHTML='\n    <div style="display:grid; grid-template-columns:340px 1fr; gap:var(--space-5); align-items:start;">\n\n      \x3c!-- Formul√°rio --\x3e\n      <div class="card">\n        <h3>üåæ Nova Fazenda</h3>\n        <div class="help">Cadastre as unidades produtivas da safra atual.</div>\n        <form id="frmFazenda" class="formGrid" style="margin-top:var(--space-4);">\n          <div class="form-group full">\n            <small>Nome da fazenda *</small>\n            <input class="input" name="nome" required placeholder="Ex: Fazenda Santa F√©">\n          </div>\n          <div class="form-group">\n            <small>Cidade</small>\n            <input class="input" name="cidade" placeholder="Ex: Sorriso">\n          </div>\n          <div class="form-group">\n            <small>UF</small>\n            <input class="input" name="uf" placeholder="MT" maxlength="2" style="text-transform:uppercase">\n          </div>\n          <div class="form-group full">\n            <small>√Årea total (ha)</small>\n            <input class="input" name="areaHa" type="number" step="0.1" placeholder="0.0">\n          </div>\n          <div class="form-group">\n            <small>Latitude</small>\n            <input class="input" name="latitude" placeholder="-12.5489">\n          </div>\n          <div class="form-group">\n            <small>Longitude</small>\n            <input class="input" name="longitude" placeholder="-55.7256">\n          </div>\n          <div class="form-group full">\n            <small>Observa√ß√µes</small>\n            <textarea class="textarea" name="observacoes" rows="2"></textarea>\n          </div>\n          <div class="full" style="display:flex; justify-content:flex-end;">\n            <button class="btn primary" type="submit">+ Adicionar fazenda</button>\n          </div>\n        </form>\n      </div>\n\n      \x3c!-- Cards de fazendas --\x3e\n      <div>\n        <h3 style="font-size:14px; font-weight:700; color:var(--text-secondary); text-transform:uppercase; letter-spacing:.6px; margin-bottom:var(--space-4);">Fazendas cadastradas</h3>\n        <div id="fazendasGrid" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(240px,1fr)); gap:var(--space-4);"></div>\n        <div id="fazPagination" class="row" style="justify-content:center; margin-top:var(--space-4); display:none;"></div>\n      </div>\n    </div>\n  ',window.__delFaz=a=>{if(!confirm("Excluir esta fazenda? Os talh√µes vinculados tamb√©m ser√£o removidos."))return;const t=getDB();t.fazendas=t.fazendas.filter(e=>e.id!==a),t.talhoes=(t.talhoes||[]).filter(e=>e.fazendaId!==a),setDB(t),toast("Fazenda exclu√≠da","E os talh√µes vinculados."),e()},document.getElementById("frmFazenda").addEventListener("submit",a=>{if(a.preventDefault(),!canCreateOnPage("fazendas"))return void toast("Acesso restrito","Seu perfil n√£o pode cadastrar fazendas.");const t=new FormData(a.target),n=getDB(),s=getPlanLimits();if(onlySafra(n.fazendas).length>=s.fazendas)return void toast("Limite atingido",`O plano ${planoAtual} permite ${s.fazendas} fazenda(s). Fa√ßa upgrade para continuar.`);const o={id:uid("faz"),safraId:getSafraId(),nome:t.get("nome").trim(),cidade:t.get("cidade")||"",uf:(t.get("uf")||"").toUpperCase(),areaHa:Number(t.get("areaHa")||0),latitude:t.get("latitude")||"",longitude:t.get("longitude")||"",observacoes:t.get("observacoes")||""};n.fazendas.push(o),setDB(n),a.target.reset(),toast("üåæ Fazenda adicionada",`"${o.nome}" cadastrada com sucesso.`),e()}),e())}function _renderTalhoesTab(){const a=document.getElementById("propContent");if(!a)return;const e=getDB(),t=onlySafra(e.fazendas),n=localStorage.getItem("prop_faz_filter")||"";function s(){const a=getDB(),e=document.getElementById("filtroFazendaTalhoes")?.value||"";let t=onlySafra(a.talhoes||[]);e&&(t=t.filter(a=>a.fazendaId===e));const n=document.getElementById("talhoesContent");if(!t.length)return void(n.innerHTML=emptyState("üß≠","Nenhum talh√£o cadastrado","Adicione o primeiro talh√£o para come√ßar a gerir as √°reas da fazenda.",canCreateOnPage("talhoes")?'<p style="font-size:12.5px; color:var(--text-muted); margin-top:8px;">Use o formul√°rio ao lado para cadastrar.</p>':""));const s={};if(t.forEach(e=>{const t=findNameById(onlySafra(a.fazendas),e.fazendaId);s[t]||(s[t]=[]),s[t].push(e)}),n.innerHTML=Object.entries(s).map(([a,e])=>`\n      <div style="margin-bottom:var(--space-5);">\n        <div style="font-size:12px; font-weight:700; color:var(--text-muted); text-transform:uppercase; letter-spacing:.6px; margin-bottom:var(--space-3); display:flex; align-items:center; gap:8px;">\n          üåæ ${escapeHtml(a)}\n          <span class="tag tag-neutral">${e.length} talh√£o${e.length>1?"√µes":""}</span>\n          <span class="tag tag-info">${num(e.reduce((a,e)=>a+Number(e.areaHa||0),0),1)} ha total</span>\n        </div>\n        <div style="display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:var(--space-3);">\n          ${e.map(a=>`\n            <div class="card" style="padding:var(--space-4); border-left:3px solid var(--brand); transition:transform var(--t-fast);"\n              onmouseover="this.style.transform='translateY(-2px)'"\n              onmouseout="this.style.transform=''">\n              <div style="font-weight:700; font-size:14px; color:var(--text); margin-bottom:6px;">${escapeHtml(a.nome||"‚Äî")}</div>\n              <div style="display:grid; grid-template-columns:1fr 1fr; gap:4px; margin-bottom:10px;">\n                <div>\n                  <div style="font-size:18px; font-weight:800; color:var(--brand);">${a.areaHa?num(a.areaHa,1):"‚Äî"}</div>\n                  <div style="font-size:10px; color:var(--text-muted); font-weight:600;">ha</div>\n                </div>\n                <div>\n                  <div style="font-size:14px; font-weight:700; color:var(--text-secondary);">${escapeHtml(a.cultura||"‚Äî")}</div>\n                  <div style="font-size:10px; color:var(--text-muted); font-weight:600;">cultura</div>\n                </div>\n              </div>\n              ${a.solo?`<div class="tag tag-neutral" style="margin-bottom:8px; font-size:10.5px;">${escapeHtml(a.solo)}</div>`:""}\n              ${canDeleteOnPage("talhoes")?`<button class="btn danger" style="width:100%;" onclick="window.__delTalProp('${a.id}')">Excluir</button>`:""}\n            </div>\n          `).join("")}\n        </div>\n      </div>\n    `).join(""),canSeeFinanceiro()){const t=calcCustosPorTalhao(a),n=(e&&t.filter(e=>findNameById(onlySafra(a.fazendas),(onlySafra(a.talhoes).find(a=>a.nome===e.talhao)||{}).fazendaId)===document.getElementById("filtroFazendaTalhoes").options[document.getElementById("filtroFazendaTalhoes").selectedIndex]?.text),document.getElementById("custosTalhoesContent"));n&&(n.innerHTML=t.length?`<div class="tableWrap" style="margin:0; border:none; box-shadow:none;">\n              <table>\n                <thead><tr><th>Talh√£o</th><th>Fazenda</th><th>√Årea (ha)</th><th>Custo Total</th><th>Custo/ha</th><th>Opera√ß√µes</th><th>√öltimo</th></tr></thead>\n                <tbody>\n                  ${t.map(a=>`<tr>\n                    <td><b>${escapeHtml(a.talhao)}</b></td>\n                    <td>${escapeHtml(a.fazenda)}</td>\n                    <td>${num(a.areaHa||0,1)}</td>\n                    <td class="highlight-value">${kbrl(a.custoTotal||0)}</td>\n                    <td>${kbrl(a.custoHa||0)}</td>\n                    <td>${a.ops||0}</td>\n                    <td>${a.last||"‚Äî"}</td>\n                  </tr>`).join("")}\n                </tbody>\n              </table>\n            </div>`:emptyState("üí∞","Sem dados de custo","Registre aplica√ß√µes e opera√ß√µes para visualizar os custos por talh√£o."))}else{const a=document.getElementById("custosTalhoesContent");a&&(a.innerHTML='<p style="color:var(--text-muted); font-size:13px; text-align:center; padding:var(--space-6);">üîí Dados financeiros dispon√≠veis apenas para administradores.</p>')}}localStorage.removeItem("prop_faz_filter"),a.innerHTML=`\n    <div style="display:grid; grid-template-columns:340px 1fr; gap:var(--space-5); align-items:start;">\n\n      \x3c!-- Formul√°rio --\x3e\n      <div class="card">\n        <h3>üß≠ Novo Talh√£o</h3>\n        <div class="help">√Årea, cultura e dados de campo por talh√£o.</div>\n        <form id="frmTalhao" class="formGrid" style="margin-top:var(--space-4);">\n          <div class="form-group full">\n            <small>Fazenda *</small>\n            <select class="select" name="fazendaId" required>\n              ${t.length?t.map(a=>`<option value="${a.id}" ${a.id===n?"selected":""}>${escapeHtml(a.nome)}</option>`).join(""):'<option value="" disabled>‚Äî Cadastre uma fazenda primeiro ‚Äî</option>'}\n            </select>\n          </div>\n          <div class="form-group full">\n            <small>Nome do talh√£o *</small>\n            <input class="input" name="nome" required placeholder="Ex: Talh√£o 01 Norte">\n          </div>\n          <div class="form-group">\n            <small>√Årea (ha)</small>\n            <input class="input" name="areaHa" type="number" step="0.1" placeholder="0.0">\n          </div>\n          <div class="form-group">\n            <small>Cultura</small>\n            <input class="input" name="cultura" placeholder="Ex: Soja">\n          </div>\n          <div class="form-group">\n            <small>Solo</small>\n            <input class="input" name="solo" placeholder="Ex: Argiloso">\n          </div>\n          <div class="form-group">\n            <small>Safra ref.</small>\n            <input class="input" name="safra" placeholder="Ex: 2025/26">\n          </div>\n          <div class="form-group full">\n            <small>Coordenadas</small>\n            <input class="input" name="coordenadas" placeholder="Opcional">\n          </div>\n          <div class="form-group full">\n            <small>Observa√ß√µes</small>\n            <textarea class="textarea" name="observacoes" rows="2"></textarea>\n          </div>\n          <div class="full" style="display:flex; justify-content:flex-end;">\n            <button class="btn primary" type="submit" ${t.length?"":"disabled"}>+ Adicionar talh√£o</button>\n          </div>\n        </form>\n      </div>\n\n      \x3c!-- Lista de talh√µes agrupados por fazenda --\x3e\n      <div>\n        \x3c!-- Filtro por fazenda --\x3e\n        <div style="display:flex; align-items:center; gap:var(--space-3); margin-bottom:var(--space-4); flex-wrap:wrap;">\n          <h3 style="font-size:14px; font-weight:700; color:var(--text-secondary); text-transform:uppercase; letter-spacing:.6px; margin:0;">Talh√µes</h3>\n          <select class="select" id="filtroFazendaTalhoes" style="max-width:200px; margin-left:auto;">\n            <option value="">Todas as fazendas</option>\n            ${t.map(a=>`<option value="${a.id}" ${a.id===n?"selected":""}>${escapeHtml(a.nome)}</option>`).join("")}\n          </select>\n          <button class="btn" id="btnExportTalhoesCSV" style="font-size:12px; padding:7px 14px;">üì• CSV</button>\n        </div>\n        <div id="talhoesContent"></div>\n\n        \x3c!-- Resumo de custos por talh√£o --\x3e\n        <div class="card" style="margin-top:var(--space-5);" id="custosTalhoes">\n          <h3>üí∞ Custo por Talh√£o</h3>\n          <div id="custosTalhoesContent"></div>\n        </div>\n      </div>\n    </div>\n  `,window.__delTalProp=a=>{if(!confirm("Excluir este talh√£o?"))return;const e=getDB();e.talhoes=(e.talhoes||[]).filter(e=>e.id!==a),setDB(e),toast("Talh√£o exclu√≠do",""),s()},document.getElementById("filtroFazendaTalhoes")?.addEventListener("change",s),document.getElementById("frmTalhao").addEventListener("submit",a=>{if(a.preventDefault(),!canCreateOnPage("talhoes"))return void toast("Acesso restrito","Seu perfil n√£o pode cadastrar talh√µes.");const e=new FormData(a.target),t=getDB(),n=getPlanLimits();if(onlySafra(t.talhoes||[]).length>=n.talhoes)return void toast("Limite atingido",`O plano ${planoAtual} permite ${n.talhoes} talh√£o(√µes). Fa√ßa upgrade.`);const o={id:uid("tal"),safraId:getSafraId(),fazendaId:e.get("fazendaId"),nome:e.get("nome").trim(),areaHa:Number(e.get("areaHa")||0),cultura:e.get("cultura")||"",safra:e.get("safra")||"",solo:e.get("solo")||"",coordenadas:e.get("coordenadas")||"",observacoes:e.get("observacoes")||""};t.talhoes=t.talhoes||[],t.talhoes.push(o),setDB(t),a.target.reset(),toast("üß≠ Talh√£o adicionado",`"${o.nome}" cadastrado.`),s()}),document.getElementById("btnExportTalhoesCSV")?.addEventListener("click",()=>{downloadText(`talhoes-${nowISO()}.csv`,toCSV(onlySafra(getDB().talhoes||[]))),toast("Exportado","CSV de talh√µes baixado.")}),s()}function pageSafras(){pagePropriedade("safras")}function pageFazendas(){pagePropriedade("fazendas")}function pageTalhoes(){pagePropriedade("talhoes")}