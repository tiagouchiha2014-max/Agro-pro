function pageManutencao(){const t=getDB(),e=onlySafra(t.maquinas);let a=onlySafra(t.talhoes);fazendaAtual&&(a=a.filter(t=>t.fazendaId===fazendaAtual));const n=onlySafra(t.manutencoes||[]).sort((t,e)=>(e.data||"").localeCompare(t.data||""));setTopActions('\n    <button class="btn" id="btnExportCSV">ğŸ“¥ Exportar CSV</button>\n    <button class="btn" id="btnExportPDF" style="background:var(--brand,#2e7d32);color:white;">ğŸ“„ Gerar PDF</button>\n  ');const o=a.reduce((t,e)=>t+Number(e.areaHa||0),0),i=n.reduce((t,e)=>t+Number(e.custoTotal||0),0),r=o>0?i/o:0,s=n.filter(t=>"Preventiva"===t.tipoManutencao).length,l=n.filter(t=>"Corretiva"===t.tipoManutencao).length,d=n.filter(t=>"Preditiva"===t.tipoManutencao).length,c=n.filter(t=>"Preventiva"===t.tipoManutencao).reduce((t,e)=>t+Number(e.custoTotal||0),0),u=n.filter(t=>"Corretiva"===t.tipoManutencao).reduce((t,e)=>t+Number(e.custoTotal||0),0),p=n.filter(t=>"Preditiva"===t.tipoManutencao).reduce((t,e)=>t+Number(e.custoTotal||0),0),m=nowISO(),v=new Date;v.setDate(v.getDate()+30);const b=n.filter(t=>t.proximaData&&t.proximaData>=m&&new Date(t.proximaData)<=v),h=[];e.forEach(t=>{const e=n.filter(e=>e.maquinaId===t.id&&"Preventiva"===e.tipoManutencao).sort((t,e)=>(e.data||"").localeCompare(t.data||""))[0];if(e){const a=Number(t.horimetro||0),n=Number(e.horimetroAtual||0)+Number(e.intervaloHoras||500);a>=n&&h.push({maquina:t.nome,maquinaId:t.id,horimetroAtual:a,proximaEm:n,excedido:a-n,ultimaData:e.data})}else Number(t.horimetro||0)>0&&h.push({maquina:t.nome,maquinaId:t.id,horimetroAtual:Number(t.horimetro||0),proximaEm:0,excedido:0,ultimaData:"Nunca"})});const f=new Map;n.forEach(t=>{const e=f.get(t.maquinaId)||{custo:0,qtd:0};e.custo+=Number(t.custoTotal||0),e.qtd+=1,f.set(t.maquinaId,e)});const x=new Array(12).fill(0);n.forEach(t=>{if(t.data){const e=parseInt(t.data.substring(5,7))-1;x[e]+=Number(t.custoTotal||0)}});const g=Math.max(...x,1);function y(t){return t.map(t=>`<option value="${t.id}">${escapeHtml(t.nome)}</option>`).join("")}function $(){let t=0;document.querySelectorAll(".peca-linha").forEach(e=>{const a=Number(e.querySelector('input[name="pecaQtd[]"]').value)||0,n=Number(e.querySelector('input[name="pecaPreco[]"]').value)||0;t+=a*n});const e=Number(document.querySelector('input[name="custoMaoObra"]').value)||0,a=Number(document.querySelector('input[name="outrosCustos"]').value)||0,n=t+e+a;return document.getElementById("custoManutDisplay").innerText=kbrl(n),n}function M(t="",a=""){const n=getDB();let o=onlySafra(n.manutencoes||[]).sort((t,e)=>(e.data||"").localeCompare(t.data||""));t&&(o=o.filter(e=>e.maquinaId===t)),a&&(o=o.filter(t=>t.tipoManutencao===a));const i=nowISO();document.getElementById("tbodyManut").innerHTML=o.map(t=>{const a=e.find(e=>e.id===t.maquinaId),n=(t.pecas||[]).map(t=>`${t.nome} (${t.qtd}x)`).join(", "),o="Corretiva"===t.tipoManutencao?"#ef4444":"Preditiva"===t.tipoManutencao?"#8b5cf6":"#059669";let r="";if(t.proximaData){const e=Math.ceil((new Date(t.proximaData)-new Date(i))/864e5);r=e<0?`<span style="color:#ef4444; font-size:11px;">âš ï¸ Vencida (${Math.abs(e)}d atrÃ¡s)</span>`:e<=15?`<span style="color:#f59e0b; font-size:11px;">â° Em ${e}d</span>`:`<span style="color:#059669; font-size:11px;">âœ” ${t.proximaData}</span>`}else r='<span style="color:#94a3b8; font-size:11px;">NÃ£o definida</span>';return`<tr>\n        <td>${t.data}</td>\n        <td><b>${escapeHtml(a?.nome||"-")}</b></td>\n        <td><span style="color:${o}; font-weight:600;">${escapeHtml(t.tipoManutencao)}</span></td>\n        <td>${escapeHtml(clampStr(t.servico||"-",40))}</td>\n        <td>${escapeHtml(clampStr(n||"-",40))}</td>\n        <td>${num(t.horimetroAtual||0,0)}h</td>\n        <td>${r}</td>\n        <td><b>${kbrl(t.custoTotal)}</b></td>\n        <td class="noPrint"><button class="btn danger" onclick="window.__delManut('${t.id}')">Excluir</button></td>\n      </tr>`}).join("")||'<tr><td colspan="9">Nenhuma manutenÃ§Ã£o registrada.</td></tr>'}document.getElementById("content").innerHTML=`\n    <style>\n      .manut-kpi-grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n        gap: 15px;\n        margin-bottom: 20px;\n      }\n      .manut-kpi-card {\n        background: #ffffff;\n        border-radius: 12px;\n        padding: 20px;\n        border-left: 4px solid #3b82f6;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.05);\n      }\n      .manut-kpi-card h3 {\n        margin: 0 0 10px 0;\n        color: #3b82f6;\n        font-size: 16px;\n      }\n      .manut-kpi-valor {\n        font-size: 32px;\n        font-weight: 700;\n        color: #0f172a;\n      }\n      .manut-kpi-label {\n        color: #475569;\n        font-size: 12px;\n        margin-top: 5px;\n      }\n      .alerta-vencida {\n        background: #fef2f2;\n        border: 1px solid #fecaca;\n        border-left: 4px solid #ef4444;\n        border-radius: 8px;\n        padding: 12px 16px;\n        margin-bottom: 10px;\n      }\n      .alerta-vencida b { color: #b91c1c; }\n      .peca-linha {\n        display: grid;\n        grid-template-columns: 2fr 1fr 1fr 0.3fr;\n        gap: 10px;\n        margin-bottom: 8px;\n        align-items: center;\n      }\n      .grafico-barras {\n        display: flex; align-items: flex-end; gap: 8px; height: 150px; margin: 15px 0;\n      }\n      .barra {\n        flex: 1; background: #f97316; border-radius: 4px 4px 0 0; min-height: 20px;\n        transition: height 0.3s;\n      }\n      .barra-label { text-align: center; font-size: 10px; color: #475569; margin-top: 5px; }\n      .filtro-maquina { margin-bottom: 15px; }\n    </style>\n\n    \x3c!-- KPIs --\x3e\n    <div class="manut-kpi-grid">\n      <div class="manut-kpi-card">\n        <h3>ğŸ”§ Total ManutenÃ§Ãµes</h3>\n        <div class="manut-kpi-valor">${n.length}</div>\n        <div class="manut-kpi-label">P: ${s} | C: ${l} | Pd: ${d}</div>\n      </div>\n      <div class="manut-kpi-card">\n        <h3>ğŸ’° Custo Total</h3>\n        <div class="manut-kpi-valor">${kbrl(i)}</div>\n        <div class="manut-kpi-label">R$ ${num(r,2)}/ha</div>\n      </div>\n      <div class="manut-kpi-card" style="border-left-color:#ef4444;">\n        <h3 style="color:#ef4444;">ğŸ”´ Custo Corretivas</h3>\n        <div class="manut-kpi-valor">${kbrl(u)}</div>\n        <div class="manut-kpi-label">${l} ocorrÃªncias</div>\n      </div>\n      <div class="manut-kpi-card" style="border-left-color:#059669;">\n        <h3 style="color:#059669;">ğŸŸ¢ Custo Preventivas</h3>\n        <div class="manut-kpi-valor">${kbrl(c)}</div>\n        <div class="manut-kpi-label">${s} ocorrÃªncias</div>\n      </div>\n      <div class="manut-kpi-card" style="border-left-color:#f59e0b;">\n        <h3 style="color:#f59e0b;">â° PrÃ³ximas (30d)</h3>\n        <div class="manut-kpi-valor" style="color:${b.length>0?"#f59e0b":"#059669"}">${b.length}</div>\n        <div class="manut-kpi-label">manutenÃ§Ãµes agendadas</div>\n      </div>\n      <div class="manut-kpi-card">\n        <h3>âš ï¸ Vencidas (horÃ­metro)</h3>\n        <div class="manut-kpi-valor" style="color: ${h.length>0?"#ef4444":"#059669"}">${h.length}</div>\n        <div class="manut-kpi-label">mÃ¡quinas com manutenÃ§Ã£o vencida</div>\n      </div>\n    </div>\n\n    \x3c!-- Alertas de manutenÃ§Ã£o vencida --\x3e\n    ${h.length>0?`\n      <div class="card" style="margin-bottom:20px;">\n        <h3>âš ï¸ Alertas de ManutenÃ§Ã£o Vencida</h3>\n        ${h.map(t=>`\n          <div class="alerta-vencida">\n            <b>ğŸšœ ${escapeHtml(t.maquina)}</b> â€” HorÃ­metro atual: <b>${num(t.horimetroAtual,0)}h</b>\n            ${t.proximaEm>0?`| PrÃ³xima prevista em: ${num(t.proximaEm,0)}h | Excedido: <b style="color:#ef4444">${num(t.excedido,0)}h</b>`:"| <b>Nenhuma manutenÃ§Ã£o preventiva registrada</b>"}\n            | Ãšltima: ${t.ultimaData}\n          </div>\n        `).join("")}\n      </div>\n    `:""}\n\n    \x3c!-- PrÃ³ximas manutenÃ§Ãµes (30 dias) --\x3e\n    ${b.length>0?`\n      <div class="card" style="margin-bottom:20px; border-left:4px solid #f59e0b;">\n        <h3>â° PrÃ³ximas ManutenÃ§Ãµes (30 dias)</h3>\n        ${b.sort((t,e)=>(t.proximaData||"").localeCompare(e.proximaData||"")).map(t=>{const a=e.find(e=>e.id===t.maquinaId),n=Math.ceil((new Date(t.proximaData)-new Date(m))/864e5);return`\n            <div style="background:#fffbeb; border:1px solid #fde68a; border-radius:6px; padding:10px 14px; margin-bottom:8px;">\n              <b>ğŸšœ ${escapeHtml(a?.nome||"-")}</b>\n              â€” <span style="color:#b45309;">${escapeHtml(t.tipoManutencao)}</span>\n              | Prevista: <b>${t.proximaData}</b>\n              | Em: <b style="color:#f59e0b;">${n} dia${1!==n?"s":""}</b>\n              ${t.servico?`| ServiÃ§o: ${escapeHtml(clampStr(t.servico,40))}`:""}\n            </div>\n          `}).join("")}\n      </div>\n    `:""}\n\n    \x3c!-- GrÃ¡fico mensal --\x3e\n    <div class="card" style="margin-bottom:20px;">\n      <h4>ğŸ“Š Custo de ManutenÃ§Ã£o por MÃªs</h4>\n      <div class="grafico-barras">\n        ${["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"].map((t,e)=>`<div style="flex:1;text-align:center;"><div class="barra" style="height:${x[e]/g*130}px;"></div><div class="barra-label">${t}</div><div style="font-size:9px;color:#475569;">${kbrl(x[e])}</div></div>`).join("")}\n      </div>\n    </div>\n\n    \x3c!-- FormulÃ¡rio --\x3e\n    <div class="card" style="margin-bottom:20px;">\n      <h3>ğŸ”§ Registrar ManutenÃ§Ã£o</h3>\n      <div class="help">Registre manutenÃ§Ãµes preventivas, corretivas ou preditivas.</div>\n      <div class="hr"></div>\n      <form id="frmManut" class="formGrid">\n        <div><small>ğŸ“… Data</small><input class="input" name="data" type="date" value="${nowISO()}" required></div>\n        <div><small>ğŸšœ MÃ¡quina</small>\n          <select class="select" name="maquinaId" required>\n            <option value="">Selecione...</option>\n            ${y(e)}\n          </select>\n        </div>\n        <div><small>ğŸ”§ Tipo de ManutenÃ§Ã£o</small>\n          <select class="select" name="tipoManutencao" required>\n            <option value="Preventiva">Preventiva</option>\n            <option value="Corretiva">Corretiva</option>\n            <option value="Preditiva">Preditiva</option>\n          </select>\n        </div>\n        <div><small>ğŸ“Š HorÃ­metro Atual</small><input class="input" name="horimetroAtual" type="number" step="0.1" placeholder="Horas atuais"></div>\n        <div><small>â±ï¸ Intervalo PrÃ³xima (horas)</small><input class="input" name="intervaloHoras" type="number" step="1" placeholder="Ex: 500" value="500"></div>\n        <div><small>ğŸ“… PrÃ³xima ManutenÃ§Ã£o (data)</small><input class="input" name="proximaData" type="date"></div>\n        <div><small>ğŸ‘¤ MecÃ¢nico/ResponsÃ¡vel</small><input class="input" name="mecanico" type="text" placeholder="Nome do mecÃ¢nico"></div>\n        <div><small>ğŸ¢ Oficina/Local</small><input class="input" name="oficina" type="text" placeholder="Oficina ou local"></div>\n        <div><small>ğŸ“‹ ServiÃ§o Realizado</small><input class="input" name="servico" type="text" placeholder="DescriÃ§Ã£o do serviÃ§o"></div>\n        <div><small>â±ï¸ Tempo de Parada (horas)</small><input class="input" name="tempoParada" type="number" step="0.5" placeholder="Horas parada"></div>\n\n        <div class="full">\n          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">\n            <h4 style="margin:0;">ğŸ”© PeÃ§as Trocadas</h4>\n            <button type="button" class="btn primary" id="btnAdicionarPeca" style="font-size:12px;">+ Adicionar peÃ§a</button>\n          </div>\n          <div id="pecas-container">\n            <div class="peca-linha">\n              <input class="input" name="pecaNome[]" placeholder="Nome da peÃ§a">\n              <input class="input" name="pecaQtd[]" type="number" step="1" placeholder="Qtd" value="1">\n              <input class="input" name="pecaPreco[]" type="number" step="0.01" placeholder="PreÃ§o unit.">\n              <button type="button" class="btn danger" style="padding:6px;" onclick="window.__removerPeca(this)">âœ•</button>\n            </div>\n          </div>\n        </div>\n\n        <div><small>ğŸ’° Custo MÃ£o de Obra (R$)</small><input class="input" name="custoMaoObra" type="number" step="0.01" placeholder="0.00"></div>\n        <div><small>ğŸ’° Outros Custos (R$)</small><input class="input" name="outrosCustos" type="number" step="0.01" placeholder="0.00"></div>\n        <div class="full"><small>ğŸ“ ObservaÃ§Ãµes</small><textarea class="textarea" name="obs"></textarea></div>\n\n        <div class="full" style="margin-top:15px;">\n          <div style="background: linear-gradient(135deg, #1a2a3a, #0f1a24); padding:20px; border-radius:8px;">\n            <div style="display:flex; justify-content:space-between; align-items:center;">\n              <div>\n                <h4 style="margin:0; color:#888;">ğŸ’µ CUSTO TOTAL DA MANUTENÃ‡ÃƒO</h4>\n                <div style="font-size:32px; font-weight:bold; color:#f97316;" id="custoManutDisplay">R$ 0,00</div>\n              </div>\n              <button class="btn primary" type="submit" style="font-size:16px; padding:12px 24px;">âœ… Salvar ManutenÃ§Ã£o</button>\n            </div>\n          </div>\n        </div>\n      </form>\n    </div>\n\n    \x3c!-- Custo por mÃ¡quina --\x3e\n    <div class="card" style="margin-bottom:20px;">\n      <h3>ğŸšœ Custo de ManutenÃ§Ã£o por MÃ¡quina</h3>\n      <div class="tableWrap">\n        <table>\n          <thead><tr><th>MÃ¡quina</th><th>ManutenÃ§Ãµes</th><th>Custo Total</th><th>Custo/ha</th><th>HorÃ­metro Atual</th></tr></thead>\n          <tbody>\n            ${e.map(t=>{const e=f.get(t.id)||{custo:0,qtd:0},a=o>0?e.custo/o:0;return`<tr>\n                <td><b>${escapeHtml(t.nome)}</b></td>\n                <td>${e.qtd}</td>\n                <td>${kbrl(e.custo)}</td>\n                <td>${kbrl(a)}</td>\n                <td>${num(t.horimetro||0,0)}h</td>\n              </tr>`}).join("")}\n          </tbody>\n        </table>\n      </div>\n    </div>\n\n    \x3c!-- Filtro e histÃ³rico --\x3e\n    <div class="card">\n      <h3>ğŸ“‹ HistÃ³rico de ManutenÃ§Ãµes</h3>\n      <div style="display:flex; gap:15px; flex-wrap:wrap; margin-bottom:15px;">\n        <div>\n          <small>Filtrar por mÃ¡quina:</small>\n          <select class="select" id="filtroMaquina" style="max-width:260px;">\n            <option value="">Todas as mÃ¡quinas</option>\n            ${y(e)}\n          </select>\n        </div>\n        <div>\n          <small>Filtrar por tipo:</small>\n          <select class="select" id="filtroTipo" style="max-width:200px;">\n            <option value="">Todos os tipos</option>\n            <option value="Preventiva">ğŸŸ¢ Preventiva</option>\n            <option value="Corretiva">ğŸ”´ Corretiva</option>\n            <option value="Preditiva">ğŸŸ£ Preditiva</option>\n          </select>\n        </div>\n      </div>\n      <div class="tableWrap">\n        <table>\n          <thead>\n            <tr>\n              <th>Data</th>\n              <th>MÃ¡quina</th>\n              <th>Tipo</th>\n              <th>ServiÃ§o</th>\n              <th>PeÃ§as</th>\n              <th>HorÃ­metro</th>\n              <th>PrÃ³xima</th>\n              <th>Custo Total</th>\n              <th class="noPrint">AÃ§Ãµes</th>\n            </tr>\n          </thead>\n          <tbody id="tbodyManut"></tbody>\n        </table>\n      </div>\n    </div>\n  `,document.getElementById("btnAdicionarPeca").addEventListener("click",()=>{const t=document.getElementById("pecas-container"),e=document.createElement("div");e.className="peca-linha",e.innerHTML='\n      <input class="input" name="pecaNome[]" placeholder="Nome da peÃ§a">\n      <input class="input" name="pecaQtd[]" type="number" step="1" placeholder="Qtd" value="1">\n      <input class="input" name="pecaPreco[]" type="number" step="0.01" placeholder="PreÃ§o unit.">\n      <button type="button" class="btn danger" style="padding:6px;" onclick="window.__removerPeca(this)">âœ•</button>\n    ',t.appendChild(e),$()}),window.__removerPeca=t=>{document.querySelectorAll(".peca-linha").length<=1||(t.closest(".peca-linha").remove(),$())},document.querySelectorAll('input[name="pecaQtd[]"], input[name="pecaPreco[]"], input[name="custoMaoObra"], input[name="outrosCustos"]').forEach(t=>{t.addEventListener("input",$)}),new MutationObserver(()=>{document.querySelectorAll('input[name="pecaQtd[]"], input[name="pecaPreco[]"]').forEach(t=>{t.removeEventListener("input",$),t.addEventListener("input",$)})}).observe(document.getElementById("pecas-container"),{childList:!0}),document.getElementById("filtroMaquina").addEventListener("change",t=>{const e=document.getElementById("filtroTipo")?.value||"";M(t.target.value,e)}),document.getElementById("filtroTipo").addEventListener("change",t=>{M(document.getElementById("filtroMaquina")?.value||"",t.target.value)}),window.__delManut=t=>{if(!confirm("Excluir esta manutenÃ§Ã£o?"))return;const e=getDB();e.manutencoes=(e.manutencoes||[]).filter(e=>e.id!==t),setDB(e),toast("ExcluÃ­do","ManutenÃ§Ã£o removida."),pageManutencao()},document.getElementById("frmManut").addEventListener("submit",t=>{t.preventDefault();const e=new FormData(t.target),a=e.get("maquinaId");if(!a)return void alert("Selecione uma mÃ¡quina");const n=e.getAll("pecaNome[]"),o=e.getAll("pecaQtd[]"),i=e.getAll("pecaPreco[]"),r=[];let s=0;for(let t=0;t<n.length;t++)if(n[t]){const e=Number(o[t])||0,a=Number(i[t])||0;r.push({nome:n[t],qtd:e,preco:a}),s+=e*a}const l=Number(e.get("custoMaoObra")||0),d=Number(e.get("outrosCustos")||0),c=s+l+d,u={id:uid("man"),safraId:getSafraId(),data:e.get("data")||nowISO(),maquinaId:a,tipoManutencao:e.get("tipoManutencao"),horimetroAtual:Number(e.get("horimetroAtual")||0),intervaloHoras:Number(e.get("intervaloHoras")||500),proximaData:e.get("proximaData")||"",mecanico:e.get("mecanico")||"",oficina:e.get("oficina")||"",servico:e.get("servico")||"",tempoParada:Number(e.get("tempoParada")||0),pecas:r,custoPecas:s,custoMaoObra:l,outrosCustos:d,custoTotal:c,obs:e.get("obs")||""},p=getDB();if(p.manutencoes=p.manutencoes||[],p.manutencoes.push(u),u.horimetroAtual>0){const t=p.maquinas.find(t=>t.id===a);t&&u.horimetroAtual>Number(t.horimetro||0)&&(t.horimetro=u.horimetroAtual)}setDB(p),toast("ManutenÃ§Ã£o registrada",`Custo: ${kbrl(c)}`),pageManutencao()}),document.getElementById("btnExportCSV").addEventListener("click",()=>{const t=n.map(t=>{const a=e.find(e=>e.id===t.maquinaId);return{Data:t.data,"MÃ¡quina":a?.nome||"-",Tipo:t.tipoManutencao,"ServiÃ§o":t.servico,"MecÃ¢nico":t.mecanico,Oficina:t.oficina,"HorÃ­metro":t.horimetroAtual,"PeÃ§as":(t.pecas||[]).map(t=>`${t.nome}(${t.qtd}x)`).join("; "),"Custo_PeÃ§as":t.custoPecas,"Custo_MÃ£oObra":t.custoMaoObra,Outros_Custos:t.outrosCustos,Custo_Total:t.custoTotal,Tempo_Parada_h:t.tempoParada,"ObservaÃ§Ãµes":t.obs}});downloadText(`manutencoes-${nowISO()}.csv`,toCSV(t)),toast("Exportado","CSV baixado.")}),document.getElementById("btnExportPDF").addEventListener("click",()=>{const t=`\n    <div class="pdf-kpi-grid">\n      <div class="pdf-kpi" style="border-left-color:#3b82f6;"><div class="label">Total Manutencoes</div><div class="value">${n.length}</div></div>\n      <div class="pdf-kpi" style="border-left-color:#16a34a;"><div class="label">Preventivas</div><div class="value">${s}</div><div class="sub">${kbrl(c)}</div></div>\n      <div class="pdf-kpi" style="border-left-color:#ef4444;"><div class="label">Corretivas</div><div class="value">${l}</div><div class="sub">${kbrl(u)}</div></div>\n      <div class="pdf-kpi" style="border-left-color:#f59e0b;"><div class="label">Preditivas</div><div class="value">${d}</div><div class="sub">${kbrl(p)}</div></div>\n      <div class="pdf-kpi" style="border-left-color:#8b5cf6;"><div class="label">Custo Total</div><div class="value">${kbrl(i)}</div><div class="sub">${kbrl(r)}/ha</div></div>\n    </div>`,a=new Map;n.forEach(t=>{const e=a.get(t.maquinaId)||{custo:0,qtd:0,horas:0};e.custo+=Number(t.custoTotal||0),e.qtd+=1,e.horas+=Number(t.tempoParada||0),a.set(t.maquinaId,e)});const o=e.length>0?`\n    <div class="pdf-section-title">Custo de Manutencao por Maquina</div>\n    <table>\n      <thead><tr><th>Maquina</th><th>Manutencoes</th><th>Custo Total</th><th>Tempo Parada (h)</th><th>Custo Medio</th></tr></thead>\n      <tbody>\n        ${e.map(t=>{const e=a.get(t.id)||{custo:0,qtd:0,horas:0};return`<tr>\n            <td><b>${escapeHtml(t.nome)}</b></td>\n            <td style="text-align:center;">${e.qtd}</td>\n            <td style="text-align:right;">${kbrl(e.custo)}</td>\n            <td style="text-align:center;">${e.horas>0?num(e.horas,1)+"h":"â€”"}</td>\n            <td style="text-align:right;">${e.qtd>0?kbrl(e.custo/e.qtd):"â€”"}</td>\n          </tr>`}).join("")}\n      </tbody>\n    </table>`:"",m=n.length>0?`\n    <div class="pdf-section-title">Detalhamento das Manutencoes</div>\n    <table>\n      <thead><tr><th>#</th><th>Data</th><th>Maquina</th><th>Tipo</th><th>Servico</th><th>Mecanico</th><th>Oficina</th><th>Horimetro</th><th>Pecas</th><th>Custo Pecas</th><th>Custo M.Obra</th><th>Custo Total</th><th>Parada</th></tr></thead>\n      <tbody>\n        ${n.map((t,a)=>{const n=e.find(e=>e.id===t.maquinaId),o=(t.pecas||[]).map(t=>`${t.nome}(${t.qtd}x)`).join(", ")||"â€”";return`<tr>\n            <td>${a+1}</td>\n            <td>${t.data||"â€”"}</td>\n            <td><b>${escapeHtml(n?.nome||"â€”")}</b></td>\n            <td>${escapeHtml(t.tipoManutencao||"â€”")}</td>\n            <td style="font-size:9px;">${escapeHtml(t.servico||"â€”")}</td>\n            <td style="font-size:9px;">${escapeHtml(t.mecanico||"â€”")}</td>\n            <td style="font-size:9px;">${escapeHtml(t.oficina||"â€”")}</td>\n            <td style="text-align:right;">${t.horimetroAtual||"â€”"}</td>\n            <td style="font-size:9px;">${escapeHtml(o)}</td>\n            <td style="text-align:right;">${kbrl(t.custoPecas||0)}</td>\n            <td style="text-align:right;">${kbrl(t.custoMaoObra||0)}</td>\n            <td style="text-align:right;" class="text-bold">${kbrl(t.custoTotal||0)}</td>\n            <td style="text-align:center;">${t.tempoParada?t.tempoParada+"h":"â€”"}</td>\n          </tr>`}).join("")}\n        <tr class="total-row">\n          <td colspan="9"><b>TOTAL</b></td>\n          <td style="text-align:right;"><b>${kbrl(n.reduce((t,e)=>t+Number(e.custoPecas||0),0))}</b></td>\n          <td style="text-align:right;"><b>${kbrl(n.reduce((t,e)=>t+Number(e.custoMaoObra||0),0))}</b></td>\n          <td style="text-align:right;"><b>${kbrl(i)}</b></td>\n          <td></td>\n        </tr>\n      </tbody>\n    </table>`:'<p style="color:#94a3b8;">Nenhuma manutencao registrada.</p>';gerarPDF({titulo:"Relatorio de Manutencao",subtitulo:"Preventivas, Corretivas, Custos por Maquina",conteudoHTML:t+o+m,orientacao:"landscape"})}),M()}